<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>BLOWEARN AGENCIES - Dashboard</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800&family=Poppins:wght@500;600;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  
  <style>
    /* -------------------------------------------------------------------------- */
    /* --- VARIABLES CSS COH√âRENTES AVEC LA PAGE D'INSCRIPTION --- */
    /* -------------------------------------------------------------------------- */
    :root {
      --color-primary: #4A90E2; /* Bleu √ânergique */
      --color-secondary: #FFC107; /* Jaune Vif/Or pour l'accent */
      --color-text-dark: #2C3E50; /* Texte Sombre (lisible) */
      --color-text-light: #ECF0F1; /* Texte Clair */
      --color-bg-light: #FFFFFF; /* Fond de Carte */
      --color-bg-gradient-1: #6DD5FA; /* D√©grad√© Fond 1 */
      --color-bg-gradient-2: #FF7582; /* D√©grad√© Fond 2 */
      --success-color: #4CD964;
      --warning-color: #FF9500;
      --danger-color: #FF3B30;
      --shadow: 0 15px 40px rgba(0,0,0,0.1), 0 0 0 1px rgba(255,255,255,0.8);
      --transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }

    /* -------------------------------------------------------------------------- */
    /* --- STYLES G√âN√âRAUX COH√âRENTS --- */
    /* -------------------------------------------------------------------------- */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Montserrat', sans-serif;
      transition: var(--transition);
    }

    body {
      background: linear-gradient(135deg, var(--color-bg-gradient-1) 0%, var(--color-bg-gradient-2) 100%);
      color: var(--color-text-dark);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      position: relative;
      overflow-x: hidden;
    }

    /* Effet de bulles anim√©es en arri√®re-plan */
    body::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-image: 
        radial-gradient(circle at 10% 20%, rgba(255, 255, 255, 0.4) 0%, transparent 25%),
        radial-gradient(circle at 80% 10%, rgba(255, 255, 255, 0.3) 0%, transparent 25%),
        radial-gradient(circle at 40% 80%, rgba(255, 255, 255, 0.3) 0%, transparent 25%),
        radial-gradient(circle at 90% 90%, rgba(255, 255, 255, 0.2) 0%, transparent 25%);
      animation: float 20s ease-in-out infinite;
      z-index: -1;
    }
    
    @keyframes float {
      0%, 100% { transform: translateY(0) scale(1); }
      50% { transform: translateY(-15px) scale(1.02); }
    }

    /* -------------------------------------------------------------------------- */
    /* --- LOADER --- */
    /* -------------------------------------------------------------------------- */
    .loader-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, var(--color-bg-gradient-1) 0%, var(--color-bg-gradient-2) 100%);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 9999;
      transition: opacity 0.5s ease, visibility 0.5s ease;
    }

    .loader-container.hidden {
      opacity: 0;
      visibility: hidden;
    }

    .loader {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: conic-gradient(#0000 10%, var(--color-primary));
      -webkit-mask: radial-gradient(farthest-side, #0000 calc(100% - 8px), #000 0);
      animation: spin 1s infinite linear;
    }

    @keyframes spin {
      to { transform: rotate(1turn); }
    }

    /* -------------------------------------------------------------------------- */
    /* --- HEADER --- */
    /* -------------------------------------------------------------------------- */
    .header {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(15px);
      box-shadow: var(--shadow);
      padding: 15px 30px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: sticky;
      top: 0;
      z-index: 100;
      border-bottom: 1px solid rgba(255,255,255,0.7);
    }

    .logo {
      font-size: 1.8rem;
      font-weight: 800; /* Plus √©pais pour plus de visibilit√© */
      color: var(--color-text-dark); /* Chang√© pour plus de contraste */
      display: flex;
      align-items: center;
      font-family: 'Poppins', sans-serif;
      text-transform: uppercase;
      letter-spacing: 2px;
      text-shadow: 0 2px 4px rgba(0,0,0,0.1); /* Ombre plus prononc√©e */
      background: linear-gradient(45deg, var(--color-primary) 0%, var(--color-secondary) 100%); /* D√©grad√© plus contrast√© */
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      animation: logoGlow 3s ease-in-out infinite alternate;
    }
    
    @keyframes logoGlow {
      from { filter: drop-shadow(0 0 5px rgba(74, 144, 226, 0.5)); }
      to { filter: drop-shadow(0 0 15px rgba(255, 193, 7, 0.7)); }
    }

    .header-controls {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .language-selector {
      background: linear-gradient(135deg, var(--color-primary) 0%, #79C3F8 100%);
      color: white;
      border: none;
      border-radius: 20px;
      padding: 8px 15px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      font-weight: 500;
      box-shadow: 0 4px 15px rgba(74, 144, 226, 0.3);
      position: relative;
    }

    .language-dropdown {
      position: absolute;
      top: 100%;
      right: 0;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(15px);
      box-shadow: var(--shadow);
      border-radius: 12px;
      padding: 8px;
      display: none;
      flex-direction: column;
      gap: 5px;
      min-width: 140px;
      z-index: 200;
      transform-origin: top right;
      animation: scaleIn 0.2s ease-out forwards;
      border: 1px solid rgba(255,255,255,0.7);
      margin-top: 5px;
    }

    .language-dropdown.active {
      display: flex;
    }

    .language-option {
      padding: 8px 12px;
      border-radius: 8px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: background-color 0.2s ease;
    }

    .language-option:hover {
      background-color: rgba(0, 0, 0, 0.05);
    }

    .language-option.active {
      background-color: rgba(74, 144, 226, 0.1);
      color: var(--color-primary);
      font-weight: 600;
    }

    .theme-toggle {
      background-color: transparent;
      border: none;
      color: var(--color-text-dark);
      cursor: pointer;
      padding: 5px;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background-color 0.3s ease;
    }

    .theme-toggle:hover {
      background-color: rgba(0, 0, 0, 0.05);
    }

    .theme-toggle i {
      font-size: 1.2rem;
    }

    .user-profile {
      display: flex;
      align-items: center;
      gap: 10px;
      cursor: pointer;
      position: relative;
    }
    
    .user-profile .avatar {
      width: 45px;
      height: 45px;
      border-radius: 50%;
      background-color: var(--color-primary);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 1.2rem;
      font-weight: bold;
      border: 2px solid var(--color-secondary);
      box-shadow: var(--shadow);
    }

    .profile-dropdown {
      position: absolute;
      top: 100%;
      right: 0;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(15px);
      box-shadow: var(--shadow);
      border-radius: 18px;
      padding: 10px;
      display: none;
      flex-direction: column;
      gap: 5px;
      min-width: 150px;
      z-index: 200;
      transform-origin: top right;
      animation: scaleIn 0.2s ease-out forwards;
      border: 1px solid rgba(255,255,255,0.7);
    }

    .profile-dropdown.active {
      display: flex;
    }
    
    @keyframes scaleIn {
      from { transform: scale(0.9); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }

    .profile-dropdown .theme-toggle {
      width: 100%;
      border-radius: 8px;
      background-color: rgba(0, 0, 0, 0.05);
      color: var(--text-color);
      justify-content: flex-start;
      padding: 10px;
      transition: background-color 0.2s ease, transform 0.2s ease;
      text-align: left;
      gap: 10px;
    }

    .profile-dropdown .theme-toggle:hover {
      background-color: rgba(0, 0, 0, 0.1);
      transform: translateY(-2px);
    }
    
    .profile-dropdown .theme-toggle span {
      flex-grow: 1;
      text-align: left;
    }

    /* -------------------------------------------------------------------------- */
    /* --- BOUTON HAMBURGER (D√âPLAC√â √Ä DROITE) --- */
    /* -------------------------------------------------------------------------- */
    .hamburger-btn {
      display: none;
      background: none;
      border: none;
      cursor: pointer;
      display: flex;
      flex-direction: column;
      justify-content: space-around;
      width: 30px;
      height: 25px;
      padding: 0;
      order: 2; /* Pour le placer √† droite dans le header */
    }
    
    .hamburger-btn .bar {
      width: 100%;
      height: 3px;
      background-color: var(--color-text-dark);
      transition: transform 0.3s ease, opacity 0.3s ease;
    }
    
    .hamburger-btn.open .bar:nth-child(2) {
      opacity: 0;
    }
    
    .hamburger-btn.open .bar:nth-child(1) {
      transform: translateY(11px) rotate(45deg);
    }
    
    .hamburger-btn.open .bar:nth-child(3) {
      transform: translateY(-11px) rotate(-45deg);
    }

    /* -------------------------------------------------------------------------- */
    /* --- STRUCTURE PRINCIPALE --- */
    /* -------------------------------------------------------------------------- */
    .main-container {
      display: flex;
      flex: 1;
    }

    /* -------------------------------------------------------------------------- */
    /* --- SIDEBAR (MENU) AM√âLIOR√â AVEC NOUVEAU FOND ET POLICE --- */
    /* -------------------------------------------------------------------------- */
    .sidebar {
      width: 280px;
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.98) 0%, rgba(240, 245, 255, 0.95) 100%);
      backdrop-filter: blur(15px);
      border-right: 1px solid rgba(255,255,255,0.7);
      box-shadow: var(--shadow);
      height: calc(100vh - 80px);
      position: sticky;
      top: 80px;
      padding: 25px 0;
      overflow-y: auto;
      transition: transform 0.4s ease-in-out; 
    }
    
    .sidebar.open {
      transform: translateX(0);
    }

    .welcome-section {
      padding: 0 25px 25px;
      border-bottom: 1px solid rgba(0, 0, 0, 0.1);
      margin-bottom: 20px;
    }

    .welcome-text {
      color: var(--color-text-dark);
      font-size: 0.9rem;
      margin-bottom: 5px;
      font-weight: 500;
      font-family: 'Quicksand', sans-serif;
    }

    .username {
      font-weight: 600;
      font-size: 1.2rem;
      color: var(--color-primary);
      font-family: 'Quicksand', sans-serif;
    }

    .menu-category {
      padding: 15px 25px 5px;
      font-size: 0.85rem;
      color: var(--color-text-dark);
      text-transform: uppercase;
      letter-spacing: 1px;
      font-weight: 600;
      font-family: 'Quicksand', sans-serif;
      border-bottom: 1px solid rgba(0, 0, 0, 0.05);
    }

    .menu-item {
      padding: 12px 25px 12px 35px;
      display: flex;
      align-items: center;
      gap: 15px;
      color: var(--color-text-dark);
      text-decoration: none;
      font-weight: 500;
      border-left: 4px solid transparent;
      position: relative;
      overflow: hidden;
      animation: fadeIn 0.5s ease-out;
      font-family: 'Quicksand', sans-serif;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateX(-20px); }
      to { opacity: 1; transform: translateX(0); }
    }
    
    .menu-item::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(0, 0, 0, 0.05), transparent);
      transition: all 0.5s ease;
    }
    
    .menu-item:hover::before {
      left: 100%;
    }

    .menu-item:hover, .menu-item.active {
      background-color: rgba(0, 0, 0, 0.05);
      border-left-color: var(--color-primary);
      color: var(--color-primary);
    }

    .menu-item i {
      width: 20px;
      text-align: center;
      font-size: 1.1rem;
      transition: transform 0.3s ease;
    }

    .menu-item:hover i {
      transform: scale(1.1) rotate(5deg);
    }

    .menu-badge {
      position: absolute;
      right: 25px;
      font-size: 0.75rem;
      font-weight: 700;
      padding: 2px 8px;
      border-radius: 10px;
      text-shadow: 0 1px 1px rgba(0, 0, 0, 0.2);
      animation: popIn 0.5s ease-out;
    }
    
    @keyframes popIn {
      from { transform: scale(0); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }
    
    .menu-badge.active {
      background-color: var(--success-color);
      color: white;
    }
    
    .menu-badge.inactive {
      background-color: var(--danger-color);
      color: white;
    }

    /* -------------------------------------------------------------------------- */
    /* --- CONTENU PRINCIPAL --- */
    /* -------------------------------------------------------------------------- */
    .content {
      flex: 1;
      padding: 30px;
    }

    .page-title {
      font-size: 1.5rem;
      margin-bottom: 25px;
      color: var(--color-text-dark);
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 10px;
      font-family: 'Poppins', sans-serif;
    }

    .page-title i {
      color: var(--color-primary);
    }

    /* -------------------------------------------------------------------------- */
    /* --- BANNI√àRE AM√âLIOR√âE AVEC CASES D√âPENSE ET PROFIT --- */
    /* -------------------------------------------------------------------------- */
    .banner {
      background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-secondary) 100%);
      border-radius: 18px;
      padding: 25px;
      box-shadow: var(--shadow);
      margin-bottom: 30px;
      color: white;
      position: relative;
      overflow: hidden;
      animation: fadeInUp 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }

    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(40px) scale(0.95); }
      to { opacity: 1; transform: translateY(0) scale(1); }
    }

    .banner::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: linear-gradient(to right, transparent, rgba(255, 255, 255, 0.2), transparent);
      transform: rotate(45deg);
      animation: shimmer 3s infinite;
    }

    @keyframes shimmer {
      0% { transform: translateX(-100%) rotate(45deg); }
      100% { transform: translateX(100%) rotate(45deg); }
    }

    .banner-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .banner-title {
      font-size: 1.2rem;
      margin-bottom: 10px;
      font-weight: 600;
      position: relative;
      z-index: 1;
    }

    .username-highlight {
      font-family: 'Pacifico', cursive;
      color: var(--color-text-light);
      font-size: 1.8rem;
      font-weight: bold;
      display: inline-block;
      margin-left: 10px;
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
    }

    .banner-text {
      font-size: 0.9rem;
      margin-bottom: 15px;
      opacity: 0.9;
      position: relative;
      z-index: 1;
    }

    /* Bouton application Android en haut */
    .app-btn {
      display: inline-block;
      background-color: white;
      color: var(--color-primary);
      padding: 10px 20px;
      border-radius: 10px;
      font-weight: 600;
      text-decoration: none;
      font-size: 0.9rem;
      position: relative;
      z-index: 1;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      border: none;
      cursor: pointer;
      box-shadow: 0 4px 15px rgba(255, 255, 255, 0.3);
    }

    .app-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(255, 255, 255, 0.4);
    }

    /* Conteneur pour les cases d√©pense et profit */
    .banner-stats {
      display: flex;
      gap: 15px;
      margin-top: 20px;
    }

    /* Cases d√©pense et profit dans la banni√®re */
    .banner-stat-card {
      flex: 1;
      background: rgba(255, 255, 255, 0.2);
      backdrop-filter: blur(10px);
      border-radius: 12px;
      padding: 15px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      min-height: 80px;
      position: relative;
      overflow: hidden;
      transition: var(--transition);
      border: 1px solid rgba(255, 255, 255, 0.3);
      animation: bounceIn 1s ease-out;
    }

    @keyframes bounceIn {
      0% { transform: scale(0.3); opacity: 0; }
      50% { transform: scale(1.05); }
      70% { transform: scale(0.9); }
      100% { transform: scale(1); opacity: 1; }
    }

    .banner-stat-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
    }

    .banner-stat-title {
      font-size: 0.8rem;
      color: rgba(255, 255, 255, 0.9);
      margin-bottom: 5px;
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .banner-stat-value {
      font-size: 1.2rem;
      font-weight: 700;
      color: white;
    }

    /* Couleurs sp√©cifiques pour les cases de la banni√®re */
    #banner-depense {
      background: rgba(231, 76, 60, 0.7); /* Rouge */
    }

    #banner-profit {
      background: rgba(46, 204, 113, 0.7); /* Vert */
    }

    /* -------------------------------------------------------------------------- */
    /* --- DEUXI√àME GROUPE: STATISTIQUES LARGES (ANIMATION DE PLUIE VISIBLE) --- */
    /* -------------------------------------------------------------------------- */
    .stats-group-2 {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 20px;
      margin-bottom: 20px;
    }

    .large-stat-card, .medium-stat-card {
      border-radius: 18px;
      padding: 25px;
      box-shadow: var(--shadow);
      display: flex;
      flex-direction: column;
      color: white;
      min-height: 150px;
      position: relative;
      overflow: hidden;
      transition: var(--transition);
      animation: fadeInUp 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }

    /* Animation de pluie visible pour les cartes du deuxi√®me groupe */
    .rain-container {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 1;
    }

    .rain-drop {
      position: absolute;
      width: 2px;
      height: 15px;
      background: linear-gradient(to bottom, rgba(255, 255, 255, 0.8), rgba(255, 255, 255, 0.4));
      border-radius: 2px;
      animation: rain-fall linear infinite;
      opacity: 0.7;
    }

    @keyframes rain-fall {
      0% {
        transform: translateY(-20px);
        opacity: 0;
      }
      10% {
        opacity: 0.7;
      }
      90% {
        opacity: 0.7;
      }
      100% {
        transform: translateY(180px);
        opacity: 0;
      }
    }

    /* Couleurs diff√©rentes pour chaque carte */
    #solde-card {
      background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
    }

    #retire-card {
      background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);
    }

    #parrainage-card {
      background: linear-gradient(135deg, #e67e22 0%, #d35400 100%);
    }

    #bonus-agent-card {
      background: linear-gradient(135deg, #1abc9c 0%, #16a085 100%);
    }

    .large-stat-card::before, .medium-stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 5px;
      background: rgba(255, 255, 255, 0.5);
      border-radius: 18px 18px 0 0;
      z-index: 2;
    }

    .large-stat-card:hover, .medium-stat-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 20px 45px rgba(0,0,0,0.15), 0 0 0 1px rgba(255,255,255,0.8);
    }

    .large-stat-title, .medium-stat-title {
      font-size: 0.9rem;
      margin-bottom: 10px;
      opacity: 0.9;
      display: flex;
      align-items: center;
      gap: 10px;
      z-index: 3;
      color: white;
    }
    
    .large-stat-value, .medium-stat-value {
      font-size: 2rem;
      font-weight: 700;
      color: white;
      margin-bottom: 5px;
      z-index: 3;
    }

    .large-stat-icon, .medium-stat-icon {
      font-size: 2rem;
      opacity: 0.7;
      z-index: 3;
      color: white;
    }

    /* Nouveaux ic√¥nes pour le deuxi√®me groupe */
    #solde-card .large-stat-icon { 
      content: "\f555"; 
      font-family: "Font Awesome 5 Free"; 
      font-weight: 900; 
    }
    
    #retire-card .medium-stat-icon { 
      content: "\f062"; 
      font-family: "Font Awesome 5 Free"; 
      font-weight: 900; 
    }
    
    #parrainage-card .medium-stat-icon { 
      content: "\f0c0"; 
      font-family: "Font Awesome 5 Free"; 
      font-weight: 900; 
    }
    
    #bonus-agent-card .medium-stat-icon { 
      content: "\f0a3"; 
      font-family: "Font Awesome 5 Free"; 
      font-weight: 900; 
    }

    /* -------------------------------------------------------------------------- */
    /* --- TROISI√àME GROUPE: CARTES DE GAINS (NOUVELLES ANIMATIONS ET COULEURS) --- */
    /* -------------------------------------------------------------------------- */
    .gain-stats {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 30px;
    }

    .gain-stat-card {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(15px);
      border-radius: 15px;
      padding: 15px;
      box-shadow: var(--shadow);
      display: flex;
      flex-direction: column;
      height: 100px;
      transition: var(--transition);
      position: relative;
      overflow: hidden;
      border: 1px solid rgba(255,255,255,0.7);
      animation: slideInFromLeft 0.6s ease-out;
    }

    @keyframes slideInFromLeft {
      from { transform: translateX(-50px); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }

    /* Nouvelle animation pour les cartes du troisi√®me groupe : effet de pulsation douce */
    .gain-stat-card::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%);
      border-radius: 15px;
      opacity: 0;
      animation: gentlePulse 4s ease-in-out infinite;
      z-index: 1;
    }

    @keyframes gentlePulse {
      0%, 100% { opacity: 0; }
      50% { opacity: 1; }
    }

    .gain-stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      border-radius: 15px 15px 0 0;
      z-index: 2;
    }

    /* Couleurs diff√©rentes pour chaque carte du troisi√®me groupe */
    #whatsapp-gains::before { background: linear-gradient(90deg, #25D366, #128C7E); }
    #trivia-gains::before { background: linear-gradient(90deg, #9C27B0, #673AB7); }
    #publicite-gains::before { background: linear-gradient(90deg, #FF9800, #FF5722); }
    #tiktok-gains::before { background: linear-gradient(90deg, #010101, #69C9D0); }
    #youtube-gains::before { background: linear-gradient(90deg, #FF0000, #CC0000); }
    #instagram-gains::before { background: linear-gradient(90deg, #E4405F, #C13584); }
    #depot-solde::before { background: linear-gradient(90deg, #4CAF50, #2E7D32); }

    .gain-stat-card:hover {
      transform: translateY(-5px) scale(1.03);
      box-shadow: 0 20px 45px rgba(0,0,0,0.15), 0 0 0 1px rgba(255,255,255,0.8);
    }

    /* Animations diff√©rentes pour chaque carte de gains */
    #whatsapp-gains { animation-delay: 0.1s; }
    #trivia-gains { animation-delay: 0.2s; }
    #publicite-gains { animation-delay: 0.3s; }
    #tiktok-gains { animation-delay: 0.4s; }
    #youtube-gains { animation-delay: 0.5s; }
    #instagram-gains { animation-delay: 0.6s; }
    #depot-solde { animation-delay: 0.7s; }

    .gain-stat-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
      z-index: 2;
    }

    .gain-stat-title {
      color: var(--color-text-dark);
      font-size: 0.75rem;
      font-weight: 500;
      z-index: 2;
    }

    .gain-stat-icon {
      width: 25px;
      height: 25px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.9rem;
      z-index: 2;
      transition: transform 0.3s ease;
      color: white;
    }

    /* Couleurs d'ic√¥nes coh√©rentes avec les cartes */
    #whatsapp-gains .gain-stat-icon { background-color: #25D366; }
    #trivia-gains .gain-stat-icon { background-color: #9C27B0; }
    #publicite-gains .gain-stat-icon { background-color: #FF9800; }
    #tiktok-gains .gain-stat-icon { background-color: #010101; }
    #youtube-gains .gain-stat-icon { background-color: #FF0000; }
    #instagram-gains .gain-stat-icon { background-color: #E4405F; }
    #depot-solde .gain-stat-icon { background-color: #4CAF50; }

    .gain-stat-card:hover .gain-stat-icon {
      transform: scale(1.2) rotate(15deg);
    }

    .gain-stat-value {
      font-size: 1rem;
      font-weight: 700;
      z-index: 2;
    }

    /* Couleurs de texte coh√©rentes avec les cartes */
    #whatsapp-gains .gain-stat-value { color: #25D366; }
    #trivia-gains .gain-stat-value { color: #9C27B0; }
    #publicite-gains .gain-stat-value { color: #FF9800; }
    #tiktok-gains .gain-stat-value { color: #010101; }
    #youtube-gains .gain-stat-value { color: #FF0000; }
    #instagram-gains .gain-stat-value { color: #E4405F; }
    #depot-solde .gain-stat-value { color: #4CAF50; }

    /* -------------------------------------------------------------------------- */
    /* --- SECTIONS SP√âCIALES (INFORMATIONS UTILISATEUR ET CALENDRIER R√âDUITS) --- */
    /* -------------------------------------------------------------------------- */
    .user-info-section, .task-calendar {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(15px);
      border-radius: 18px;
      padding: 20px; /* R√©duit de 25px √† 20px */
      box-shadow: var(--shadow);
      margin-bottom: 20px; /* R√©duit de 30px √† 20px */
      position: relative;
      overflow: hidden;
      border: 1px solid rgba(255,255,255,0.7);
      animation: fadeInUp 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      max-height: 400px; /* Hauteur r√©duite */
      overflow-y: auto;
    }

    .user-info-section::before, .task-calendar::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 5px;
      background: linear-gradient(90deg, var(--color-primary), var(--color-secondary));
      border-radius: 18px 18px 0 0;
    }

    .section-title {
      font-size: 1.3rem;
      margin-bottom: 15px; /* R√©duit de 20px √† 15px */
      color: var(--color-text-dark);
      font-weight: 600;
      position: relative;
      z-index: 1;
      font-family: 'Poppins', sans-serif;
    }

    /* -------------------------------------------------------------------------- */
    /* --- INFORMATIONS UTILISATEUR (R√âDUIT) --- */
    /* -------------------------------------------------------------------------- */
    .user-info-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); /* R√©duit de 200px √† 180px */
      gap: 15px; /* R√©duit de 20px √† 15px */
    }

    .info-item {
      display: flex;
      flex-direction: column;
      position: relative;
      z-index: 1;
      padding: 12px; /* R√©duit de 15px √† 12px */
      background: rgba(255, 255, 255, 0.5);
      border-radius: 8px;
      transition: transform 0.3s ease;
    }

    .info-item:hover {
      transform: translateY(-3px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }

    .info-label {
      font-size: 0.8rem; /* R√©duit de 0.85rem */
      color: var(--color-text-dark);
      margin-bottom: 5px;
    }

    .info-value {
      font-size: 0.9rem; /* R√©duit de 1rem */
      font-weight: 500;
      color: var(--color-primary);
    }

    /* -------------------------------------------------------------------------- */
    /* --- CALENDRIER DES T√ÇCHES (R√âDUIT ET AM√âLIOR√â) --- */
    /* -------------------------------------------------------------------------- */
    .calendar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px; /* R√©duit de 20px √† 15px */
      position: relative;
      z-index: 1;
    }

    .calendar-month {
      font-weight: 600;
      color: var(--color-text-dark);
    }

    .calendar-nav {
      display: flex;
      gap: 10px;
    }

    .nav-btn {
      width: 30px; /* R√©duit de 35px */
      height: 30px; /* R√©duit de 35px */
      border-radius: 50%;
      background: linear-gradient(135deg, var(--color-primary) 0%, #79C3F8 100%);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .nav-btn:hover {
      transform: scale(1.1);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }

    .calendar-days {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 5px;
      margin-bottom: 10px; /* R√©duit de 15px √† 10px */
    }

    .day-header {
      text-align: center;
      padding: 8px; /* R√©duit de 10px */
      font-weight: 600;
      color: var(--color-text-dark);
      font-size: 0.8rem; /* R√©duit de 0.9rem */
    }

    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 5px;
      margin-bottom: 15px; /* Ajout d'une marge en bas */
    }

    .calendar-date {
      height: 35px; /* R√©duit de 40px */
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 8px;
      cursor: pointer;
      position: relative;
      background-color: rgba(255, 255, 255, 0.5);
      transition: all 0.2s ease;
      font-size: 0.8rem; /* R√©duit la taille de police */
    }

    .calendar-date:hover {
      background-color: rgba(0, 0, 0, 0.05);
      transform: scale(1.05);
    }

    .calendar-date.active {
      background: linear-gradient(135deg, var(--color-primary) 0%, #79C3F8 100%);
      color: white;
      transform: scale(1.05);
      animation: pulse 2s infinite;
    }

    /* Styles pour les jours de la semaine avec t√¢ches */
    .calendar-date.today-task {
      background: linear-gradient(135deg, var(--color-secondary) 0%, #FFD54F 100%);
      color: white;
      font-weight: bold;
      box-shadow: 0 0 10px rgba(255, 193, 7, 0.5);
    }

    .calendar-date.monday { border-left: 3px solid #FF6B6B; }
    .calendar-date.tuesday { border-left: 3px solid #4ECDC4; }
    .calendar-date.wednesday { border-left: 3px solid #45B7D1; }
    .calendar-date.thursday { border-left: 3px solid #96CEB4; }
    .calendar-date.friday { border-left: 3px solid #FFEAA7; }
    .calendar-date.saturday { border-left: 3px solid #DDA0DD; }
    .calendar-date.sunday { border-left: 3px solid #98D8C8; opacity: 0.7; }

    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }

    .task-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px; /* R√©duit de 20px √† 15px */
      font-size: 0.85rem; /* R√©duit la taille de police */
    }

    .task-table th, .task-table td {
      padding: 10px 12px; /* R√©duit de 12px 15px */
      text-align: left;
      border-bottom: 1px solid #ddd;
    }

    .task-table th {
      background-color: rgba(0, 0, 0, 0.05);
      font-weight: 600;
      color: var(--color-text-dark);
    }

    .task-table tr {
      transition: background-color 0.2s ease;
    }

    .task-table tr:hover {
      background-color: rgba(0, 0, 0, 0.03);
      transform: scale(1.01);
    }

    /* Mise en √©vidence de la t√¢che du jour */
    .task-table tr.today-task {
      background: linear-gradient(135deg, rgba(255, 193, 7, 0.1) 0%, rgba(255, 193, 7, 0.2) 100%);
      border-left: 4px solid var(--color-secondary);
    }

    /* -------------------------------------------------------------------------- */
    /* --- PARRAINAGE --- */
    /* -------------------------------------------------------------------------- */
    .referral-section {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(15px);
      border-radius: 18px;
      padding: 25px;
      box-shadow: var(--shadow);
      margin-bottom: 30px;
      position: relative;
      overflow: hidden;
      border: 1px solid rgba(255,255,255,0.7);
      animation: fadeInUp 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }

    .referral-section::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 5px;
      background: linear-gradient(90deg, var(--color-primary), var(--color-secondary));
      border-radius: 18px 18px 0 0;
    }

    .referral-content {
      display: flex;
      gap: 30px;
      flex-wrap: wrap;
    }

    .referral-link-container {
      flex: 1;
      min-width: 300px;
    }

    .link-box {
      background-color: rgba(0, 0, 0, 0.05);
      border-radius: 10px;
      padding: 15px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 15px;
      position: relative;
      z-index: 1;
      transition: transform 0.3s ease;
    }

    .link-box:hover {
      transform: translateY(-3px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }

    .link-text {
      font-size: 0.9rem;
      color: var(--color-text-dark);
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      flex: 1;
      margin-right: 15px;
    }

    .copy-btn {
      background: linear-gradient(135deg, var(--color-primary) 0%, #79C3F8 100%);
      color: white;
      border: none;
      border-radius: 10px;
      padding: 8px 12px;
      cursor: pointer;
      font-size: 0.85rem;
      display: flex;
      align-items: center;
      gap: 5px;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
      box-shadow: 0 4px 15px rgba(74, 144, 226, 0.3);
    }

    .copy-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(74, 144, 226, 0.4);
    }

    .social-share {
      display: flex;
      gap: 10px;
      margin-top: 15px;
    }

    .social-btn {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 1.2rem;
      cursor: pointer;
      transition: transform 0.2s;
      position: relative;
      z-index: 1;
      animation: pulseSocial 2s infinite;
    }

    @keyframes pulseSocial {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }

    .social-btn:hover {
      animation: none;
      transform: scale(1.15);
    }

    .whatsapp { background: linear-gradient(135deg, #25D366 0%, #128C7E 100%); }
    .facebook { background: linear-gradient(135deg, #3b5998 0%, #2d4373 100%); }
    .twitter { background: linear-gradient(135deg, #1DA1F2 0%, #0d8bd9 100%); }
    .telegram { background: linear-gradient(135deg, #0088cc 0%, #006699 100%); }

    /* -------------------------------------------------------------------------- */
    /* --- FOOTER AM√âLIOR√â --- */
    /* -------------------------------------------------------------------------- */
    .footer {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(15px);
      padding: 20px 30px;
      text-align: center;
      box-shadow: 0 -4px 12px rgba(0, 0, 0, 0.08);
      margin-top: auto;
      border-top: 1px solid rgba(255,255,255,0.7);
    }

    .footer-content {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .footer-links {
      display: flex;
      justify-content: center;
      gap: 20px;
      flex-wrap: wrap;
    }

    .footer-link {
      color: var(--color-primary);
      text-decoration: none;
      font-weight: 500;
      transition: color 0.2s ease;
    }

    .footer-link:hover {
      text-decoration: underline;
      color: var(--color-secondary);
    }

    .footer-text {
      color: var(--color-text-dark);
      font-size: 0.9rem;
    }

    /* Bouton de support */
    .support-btn {
      background: linear-gradient(135deg, var(--color-primary) 0%, #79C3F8 100%);
      color: white;
      border: none;
      border-radius: 10px;
      padding: 10px 20px;
      cursor: pointer;
      font-weight: 600;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
      box-shadow: 0 4px 15px rgba(74, 144, 226, 0.3);
      margin-top: 10px;
    }

    .support-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(74, 144, 226, 0.4);
    }

    /* -------------------------------------------------------------------------- */
    /* --- NOTIFICATIONS --- */
    /* -------------------------------------------------------------------------- */
    .notification-container {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 9999;
      display: flex;
      flex-direction: column;
      gap: 10px;
      pointer-events: none;
    }

    .notification {
      padding: 15px 20px;
      border-radius: 10px;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
      display: flex;
      align-items: center;
      gap: 10px;
      max-width: 350px;
      animation: slideIn 0.3s ease forwards;
      position: relative;
      overflow: hidden;
      color: white;
      pointer-events: auto;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.2);
    }

    .notification.success {
      background: linear-gradient(135deg, var(--success-color) 0%, #2AB32A 100%);
    }

    .notification.error {
      background: linear-gradient(135deg, var(--danger-color) 0%, #c0392b 100%);
    }

    .notification.info { 
      background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-secondary) 100%); 
    }

    @keyframes slideIn {
      from {
        transform: translateX(110%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    /* -------------------------------------------------------------------------- */
    /* --- OVERLAY --- */
    /* -------------------------------------------------------------------------- */
    .overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 98;
    }
    
    .overlay.active {
      display: block;
    }

    /* -------------------------------------------------------------------------- */
    /* --- MODE NUIT --- */
    /* -------------------------------------------------------------------------- */
    .dark-mode {
      --color-primary: #5e81ac;
      --color-secondary: #d08770;
      --color-text-dark: #eceff4;
      --color-text-light: #2e3440;
      --color-bg-light: #3b4252;
      --color-bg-gradient-1: #2e3440;
      --color-bg-gradient-2: #4c566a;
      --success-color: #a3be8c;
      --warning-color: #ebcb8b;
      --danger-color: #bf616a;
      --shadow: 0 15px 40px rgba(0,0,0,0.3), 0 0 0 1px rgba(255,255,255,0.1);
    }

    .dark-mode body::before {
      background-image: 
        radial-gradient(circle at 10% 20%, rgba(76, 86, 106, 0.4) 0%, transparent 25%),
        radial-gradient(circle at 80% 10%, rgba(76, 86, 106, 0.3) 0%, transparent 25%),
        radial-gradient(circle at 40% 80%, rgba(76, 86, 106, 0.3) 0%, transparent 25%),
        radial-gradient(circle at 90% 90%, rgba(76, 86, 106, 0.2) 0%, transparent 25%);
    }

    .dark-mode .header,
    .dark-mode .sidebar,
    .dark-mode .user-info-section,
    .dark-mode .task-calendar,
    .dark-mode .referral-section,
    .dark-mode .footer,
    .dark-mode .gain-stat-card {
      background: rgba(59, 66, 82, 0.95);
      color: var(--color-text-dark);
    }

    .dark-mode .banner {
      background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-secondary) 100%);
    }

    .dark-mode .gain-stat-card {
      background: rgba(59, 66, 82, 0.9);
    }

    /* -------------------------------------------------------------------------- */
    /* --- RESPONSIVE --- */
    /* -------------------------------------------------------------------------- */
    @media (max-width: 992px) {
      .sidebar {
        width: 230px;
      }
      
      .stats-group-2 {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    @media (max-width: 768px) {
      .main-container {
        flex-direction: column;
      }
      
      .hamburger-btn {
        display: flex;
        position: static; /* Position normale dans le flux */
        order: 2; /* Pour le placer √† droite */
      }

      /* NOUVEAU STYLE POUR LE MENU HAMBURGER EN VERSION MOBILE */
      .sidebar {
        width: 85%;
        max-width: 320px;
        height: 100vh;
        position: fixed;
        top: 0;
        left: -100%;
        z-index: 99;
        transition: left 0.4s ease-in-out;
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.98) 0%, rgba(240, 245, 255, 0.97) 100%);
        box-shadow: 0 0 50px rgba(0, 0, 0, 0.2);
        border-radius: 0 25px 25px 0;
        overflow-y: auto;
      }
      
      .sidebar.open {
        left: 0;
      }
      
      .header {
        padding: 15px;
      }
      
      .logo {
        font-size: 1.5rem;
        margin-left: 0; /* Supprim√© le d√©calage pr√©c√©dent */
      }
      
      .content {
        padding: 20px;
      }
      
      .stats-group-2 {
        grid-template-columns: 1fr;
      }
      
      .gain-stats {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .user-info-grid {
        grid-template-columns: 1fr;
      }

      .footer-links {
        flex-direction: column;
        gap: 10px;
      }

      .banner-stats {
        flex-direction: column;
      }

      .banner-header {
        flex-direction: column;
        gap: 15px;
        align-items: flex-start;
      }
    }

    @media (max-width: 576px) {
      .gain-stats {
        grid-template-columns: 1fr;
      }
      
      .task-table {
        display: block;
        overflow-x: auto;
      }
      
      .user-name {
        display: none;
      }
      
      .language-selector span {
        display: none;
      }
      
      .language-selector {
        padding: 8px;
      }
    }

    /* -------------------------------------------------------------------------- */
    /* --- BANNI√àRE DEBUG (CACH√âE PAR D√âFAUT) --- */
    /* -------------------------------------------------------------------------- */
    #debugBanner {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: linear-gradient(135deg, var(--warning-color) 0%, #FF6B00 100%);
      color: white;
      padding: 12px 20px;
      text-align: center;
      z-index: 10000;
      font-size: 14px;
      font-weight: 600;
      box-shadow: 0 -2px 10px rgba(0,0,0,0.2);
      display: none;
    }
    
    #debugBanner.show {
      display: block;
    }
  </style>
</head>
<body>
  <div id="debugBanner">Chargement...</div>

  <div class="loader-container" id="loader">
    <div class="loader"></div>
  </div>

  <div class="notification-container" id="notificationContainer"></div>

  <header class="header">
    <div class="logo">
      <span>BLOWEARN</span>
    </div>
    
    <div class="header-controls">
      <div class="language-selector-container">
        <button class="language-selector" id="languageSelector">
          <i class="fas fa-globe"></i>
          <span id="currentLanguage">French</span>
          <i class="fas fa-chevron-down"></i>
        </button>
        <div class="language-dropdown" id="languageDropdown">
          <div class="language-option active" data-lang="fr">
            <i class="fas fa-check"></i>
            <span>Fran√ßais</span>
          </div>
          <div class="language-option" data-lang="en">
            <i class="fas fa-check" style="opacity: 0;"></i>
            <span>English</span>
          </div>
        </div>
      </div>
      
      <button class="hamburger-btn" id="hamburgerBtn" aria-label="Toggle menu">
        <div class="bar"></div>
        <div class="bar"></div>
        <div class="bar"></div>
      </button>
      
      <div class="user-profile" id="userProfile">
          <div class="avatar" id="userAvatar">U</div>
          <div class="profile-dropdown" id="profileDropdown">
              <button class="theme-toggle" id="themeToggle">
                  <i class="fas fa-moon"></i>
                  <span>Mode nuit</span>
              </button>
          </div>
      </div>
    </div>
  </header>

  <div class="overlay" id="overlay"></div>

  <div class="main-container">
    <aside class="sidebar" id="sidebar">
      <div class="welcome-section">
        <div class="welcome-text" data-i18n="dashboard.title">Dashboard >> BLOWEARN AGENCIES</div>
        <div class="username" id="sidebarUsername">Utilisateur</div>
      </div>
      
      <div class="menu-category" data-i18n="menu.main">PRINCIPAL</div>
      <a href="dashboard.html" class="menu-item active">
        <i class="fas fa-home"></i>
        <span data-i18n="menu.dashboard">Tableau de bord</span>
        <span class="menu-badge active">‚òë</span>
      </a>
      
      <a href="depot.html" class="menu-item">
        <i class="fas fa-wallet"></i>
        <span data-i18n="menu.deposit">D√©p√¥t üíµ</span>
        <span class="menu-badge inactive">‚òê</span>
      </a>
      
      <a href="bonus_bienvenue.html" class="menu-item">
        <i class="fas fa-gift"></i>
        <span data-i18n="menu.welcome_bonus">Bonus de bienvenue</span>
        <span class="menu-badge inactive">‚òí</span>
      </a>
      
      <div class="menu-category" data-i18n="menu.accounts">COMPTES</div>
      <a href="retrait.html" class="menu-item">
        <i class="fas fa-money-bill-wave"></i>
        <span data-i18n="menu.withdrawal">Retrait</span>
        <span class="menu-badge inactive">‚òê</span>
      </a>
      
      <a href="equipe.html" class="menu-item">
        <i class="fas fa-users"></i>
        <span data-i18n="menu.team">√âquipe</span>
        <span class="menu-badge inactive">‚òí</span>
      </a>

      <div class="menu-category" data-i18n="menu.special">SP√âCIAL</div>
      
      <a href="social_boost.html" class="menu-item">
        <i class="fas fa-rocket"></i>
        <span data-i18n="menu.sbh">SBH</span>
        <span class="menu-badge inactive">‚òê</span>
      </a>
      
      <a href="challenge_reward.html" class="menu-item">
        <i class="fas fa-medal"></i>
        <span data-i18n="menu.challenge">Challenge and Reward</span>
        <span class="menu-badge inactive">‚òê</span>
      </a>
      
      <div class="menu-category" data-i18n="menu.products">PRODUIT / T√ÇCHE</div>
      <a href="whatsapp_earn.html" class="menu-item">
        <i class="fab fa-whatsapp"></i>
        <span data-i18n="menu.whatsapp_earn">Gagner via Whatsapp</span>
        <span class="menu-badge inactive">‚òê</span>
      </a>
      
      <a href="gains_publicitaires.html" class="menu-item">
        <i class="fas fa-ad"></i>
        <span data-i18n="menu.ad_earnings">Gains publicitaires</span>
        <span class="menu-badge inactive">‚òê</span>
      </a>
      
      <a href="spin_wheel.html" class="menu-item">
        <i class="fas fa-trophy"></i>
        <span data-i18n="menu.fortune_wheel">Roue de la fortune üèÜ</span>
        <span class="menu-badge inactive">‚òê</span>
      </a>
      
      <a href="tiktok_earn.html" class="menu-item">
        <i class="fab fa-tiktok"></i>
        <span data-i18n="menu.tiktok_earn">TikTok Earn</span>
        <span class="menu-badge inactive">‚òê</span>
      </a>
      
      <a href="youtube_earn.html" class="menu-item">
        <i class="fab fa-youtube"></i>
        <span data-i18n="menu.youtube_earn">YouTube Earn</span>
        <span class="menu-badge inactive">‚òê</span>
      </a>
      
      <a href="instagram_earn.html" class="menu-item">
        <i class="fab fa-instagram"></i>
        <span data-i18n="menu.instagram_earn">Instagram Earn</span>
        <span class="menu-badge inactive">‚òê</span>
      </a>
      
      <a href="trivia_challenge.html" class="menu-item">
        <i class="fas fa-brain"></i>
        <span data-i18n="menu.trivia">TRIVIA challenge</span>
        <span class="menu-badge inactive">‚òê</span>
      </a>
      
      <div class="menu-category" data-i18n="menu.bonus">BONUS</div>
      <a href="social-boost.html" class="menu-item">
        <i class="fas fa-rocket"></i>
        <span data-i18n="menu.visibility_booster">Booster ma visibilit√©</span>
        <span class="menu-badge inactive">‚òê</span>
      </a>
      
      <a href="connexion_gratuite.html" class="menu-item">
        <i class="fas fa-shield-alt"></i>
        <span data-i18n="menu.free_connection">Connexion gratuite</span>
        <span class="menu-badge inactive">‚òê</span>
      </a>
    </aside>

    <main class="content">
      <h1 class="page-title">
        <i class="fas fa-home"></i>
        <span data-i18n="dashboard.title">Dashboard >> BLOWEARN AGENCIES</span>
      </h1>
      
      <!-- Banni√®re am√©lior√©e avec cases d√©pense et profit -->
      <div class="banner" id="welcomeBanner">
        <div class="banner-header">
          <div>
            <div class="banner-title" id="welcomeTitle">
                <span data-i18n="banner.welcome">Bienvenue,</span>
                <span class="username-highlight" id="bannerUsername">Utilisateur</span>
            </div>
            <div class="banner-text" id="welcomeMessage" data-i18n="banner.message">
              BLOWEARN AGENCIES vous offre plus de 10 outils num√©riques pour maximiser vos revenus en ligne. Des annonces aux promotions YouTube et trivia, sp√©cialement con√ßus pour VOUS ! Am√©liorez votre pr√©sence en ligne d√®s maintenant ! üí∞ üöÄ
            </div>
          </div>
          <a href="https://whatsapp.com/channel/0029VbBdIuN7YSd2pFCi2u05" class="app-btn" data-i18n="banner.app_button">CLIQUEZ ICI pour obtenir l'application Android</a>
        </div>
        
        <div class="banner-stats">
          <div class="banner-stat-card" id="banner-depense">
            <div class="banner-stat-title">
              <i class="fas fa-arrow-down"></i>
              <span data-i18n="banner.expense">D√©pense:</span>
            </div>
            <div class="banner-stat-value">XAF 0</div>
          </div>
          
          <div class="banner-stat-card" id="banner-profit">
            <div class="banner-stat-title">
              <i class="fas fa-arrow-up"></i>
              <span data-i18n="banner.profit">Profit:</span>
            </div>
            <div class="banner-stat-value">XAF 0</div>
          </div>
        </div>
      </div>
      
      <!-- Deuxi√®me groupe avec animation de pluie visible -->
      <div class="stats-group-2">
        <div class="large-stat-card" id="solde-card">
          <div class="rain-container" id="rain-solde"></div>
          <div class="large-stat-title">
            <i class="fas fa-wallet large-stat-icon"></i>
            <span data-i18n="stats.balance">SOLDE</span>
          </div>
          <div class="large-stat-value">XAF 0</div>
          <div class="stat-change">
            <span data-i18n="stats.volume">Vol:(0%)</span>
          </div>
        </div>
      
        <div class="medium-stat-card" id="retire-card">
          <div class="rain-container" id="rain-retire"></div>
          <div class="medium-stat-title">
            <i class="fas fa-arrow-up medium-stat-icon"></i>
            <span data-i18n="stats.withdrawn">Retir√©</span>
          </div>
          <div class="medium-stat-value">XAF 0</div>
          <div class="stat-change">
            <span data-i18n="stats.volume">Vol:(0%)</span>
          </div>
        </div>
        
        <div class="medium-stat-card" id="parrainage-card">
          <div class="rain-container" id="rain-parrainage"></div>
          <div class="medium-stat-title">
            <i class="fas fa-users medium-stat-icon"></i>
            <span data-i18n="stats.referral_earnings">Gains de parrainage</span>
          </div>
          <div class="medium-stat-value">XAF 0</div>
          <div class="stat-change">
            <span data-i18n="stats.volume">Vol:(0%)</span>
          </div>
        </div>
        
        <div class="medium-stat-card" id="bonus-agent-card">
          <div class="rain-container" id="rain-bonus"></div>
          <div class="medium-stat-title">
            <i class="fas fa-gift medium-stat-icon"></i>
            <span data-i18n="stats.agent_bonus">Bonus d'agent</span>
          </div>
          <div class="medium-stat-value">XAF 0</div>
          <div class="stat-change">
            <span data-i18n="stats.volume">Vol:(0%)</span>
          </div>
        </div>
      </div>
      
      <!-- Troisi√®me groupe avec NOUVELLES ANIMATIONS ET COULEURS -->
      <div class="gain-stats">
        <div class="gain-stat-card" id="whatsapp-gains">
          <div class="gain-stat-header">
            <div class="gain-stat-title" data-i18n="gains.whatsapp">Gains WhatsApp</div>
            <div class="gain-stat-icon">
              <i class="fab fa-whatsapp"></i>
            </div>
          </div>
          <div class="gain-stat-value">XAF 0</div>
        </div>
        
        <div class="gain-stat-card" id="trivia-gains">
          <div class="gain-stat-header">
            <div class="gain-stat-title" data-i18n="gains.trivia">Gains Trivia</div>
            <div class="gain-stat-icon">
              <i class="fas fa-question-circle"></i>
            </div>
          </div>
          <div class="gain-stat-value">XAF 0</div>
        </div>
        
        <div class="gain-stat-card" id="publicite-gains">
          <div class="gain-stat-header">
            <div class="gain-stat-title" data-i18n="gains.advertising">Gains publicitaires</div>
            <div class="gain-stat-icon">
              <i class="fas fa-ad"></i>
            </div>
          </div>
          <div class="gain-stat-value">XAF 0</div>
        </div>
        
        <div class="gain-stat-card" id="tiktok-gains">
          <div class="gain-stat-header">
            <div class="gain-stat-title" data-i18n="gains.tiktok">Gains TikTok</div>
            <div class="gain-stat-icon">
              <i class="fab fa-tiktok"></i>
            </div>
          </div>
          <div class="gain-stat-value">XAF 0</div>
        </div>
        
        <div class="gain-stat-card" id="youtube-gains">
          <div class="gain-stat-header">
            <div class="gain-stat-title" data-i18n="gains.youtube">Gains YouTube</div>
            <div class="gain-stat-icon">
              <i class="fab fa-youtube"></i>
            </div>
          </div>
          <div class="gain-stat-value">XAF 0</div>
        </div>
        
        <div class="gain-stat-card" id="instagram-gains">
          <div class="gain-stat-header">
            <div class="gain-stat-title" data-i18n="gains.instagram">Gains Instagram</div>
            <div class="gain-stat-icon">
              <i class="fab fa-instagram"></i>
            </div>
          </div>
          <div class="gain-stat-value">XAF 0</div>
        </div>
        
        <div class="gain-stat-card" id="depot-solde">
          <div class="gain-stat-header">
            <div class="gain-stat-title" data-i18n="gains.deposit_balance">Solde du d√©p√¥t</div>
            <div class="gain-stat-icon">
              <i class="fas fa-piggy-bank"></i>
            </div>
          </div>
          <div class="gain-stat-value">XAF 0</div>
        </div>
      </div>
      
      <div class="referral-section">
        <h2 class="section-title" data-i18n="referral.title">LIEN DE PARRAINAGE</h2>
        
        <div class="referral-content">
          <div class="referral-link-container">
            <div class="link-box">
              <div class="link-text" id="referralLink">Chargement du lien...</div> 
              <button class="copy-btn" id="copyLinkBtn">
                <i class="fas fa-copy"></i>
                <span data-i18n="referral.copy">Copier</span>
              </button>
            </div>
            
            <div class="social-share">
              <div class="social-btn whatsapp" id="shareWhatsApp">
                <i class="fab fa-whatsapp"></i>
              </div>
              <div class="social-btn facebook" id="shareFacebook">
                <i class="fab fa-facebook-f"></i>
              </div>
              <div class="social-btn twitter" id="shareTwitter">
                <i class="fab fa-twitter"></i>
              </div>
              <div class="social-btn telegram" id="shareTelegram">
                <i class="fab fa-telegram-plane"></i>
              </div>
            </div>
            
            <p data-i18n="referral.description">Partagez ce lien avec vos amis et gagnez des commissions sur leurs activit√©s.</p>
          </div>
        </div>
      </div>
      
      <div class="user-info-section">
        <h2 class="section-title" data-i18n="user_info.title">INFORMATIONS UTILISATEUR</h2>
        
        <div class="user-info-grid">
          <div class="info-item">
            <div class="info-label" data-i18n="user_info.username">Nom d'utilisateur</div>
            <div class="info-value" id="info-username">Chargement...</div>
          </div>
          
          <div class="info-item">
            <div class="info-label" data-i18n="user_info.email">Email</div>
            <div class="info-value" id="info-email">Chargement...</div>
          </div>
          
          <div class="info-item">
            <div class="info-label" data-i18n="user_info.phone">T√©l√©phone</div>
            <div class="info-value" id="info-phone">Chargement...</div>
          </div>
          
          <div class="info-item">
            <div class="info-label" data-i18n="user_info.country">Pays</div>
            <div class="info-value" id="info-country">Chargement...</div>
          </div>
          
          <div class="info-item">
            <div class="info-label" data-i18n="user_info.referrer">Parrain</div>
            <div class="info-value" id="info-parrain">Chargement...</div> 
          </div>
          
          <div class="info-item">
            <div class="info-label" data-i18n="user_info.active_referrals">Parrainage actif</div>
            <div class="info-value" id="info-parrainage">Chargement...</div> 
          </div>
        </div>
      </div>
      
      <div class="task-calendar">
        <h2 class="section-title" data-i18n="calendar.title">CALENDRIER DES T√ÇCHES</h2>
        
        <div class="calendar-header">
          <div class="calendar-month">Septembre 2025</div>
          <div class="calendar-nav">
            <div class="nav-btn" id="prevMonth">
              <i class="fas fa-chevron-left"></i>
            </div>
            <div class="nav-btn" id="nextMonth">
              <i class="fas fa-chevron-right"></i>
            </div>
          </div>
        </div>
        
        <div class="calendar-days">
          <div class="day-header" data-i18n="calendar.mon">Lun</div>
          <div class="day-header" data-i18n="calendar.tue">Mar</div>
          <div class="day-header" data-i18n="calendar.wed">Mer</div>
          <div class="day-header" data-i18n="calendar.thu">Jeu</div>
          <div class="day-header" data-i18n="calendar.fri">Ven</div>
          <div class="day-header" data-i18n="calendar.sat">Sam</div>
          <div class="day-header" data-i18n="calendar.sun">Dim</div>
        </div>
        
        <div class="calendar-grid">
          <!-- Le calendrier sera g√©n√©r√© par JavaScript -->
        </div>
        
        <table class="task-table">
          <thead>
            <tr>
              <th data-i18n="calendar.day">JOUR</th>
              <th data-i18n="calendar.task">T√ÇCHE</th>
              <th data-i18n="calendar.bonus">BONUS</th>
            </tr>
          </thead>
          <tbody>
            <tr class="monday-task">
              <td data-i18n="calendar.monday">LUNDI</td>
              <td data-i18n="calendar.monday_task">Vid√©os TikTok</td>
              <td data-i18n="calendar.monday_bonus">Liste de contact gratuite, Booster, Visibilit√©, Roue de la fortune</td>
            </tr>
            <tr class="tuesday-task">
              <td data-i18n="calendar.tuesday">MARDI</td>
              <td data-i18n="calendar.tuesday_task">Vid√©os YouTube</td>
              <td data-i18n="calendar.tuesday_bonus">Liste de contact gratuite, Canva Pro, Connexion gratuite, Roue de la fortune</td>
            </tr>
            <tr class="wednesday-task">
              <td data-i18n="calendar.wednesday">MERCREDI</td>
              <td data-i18n="calendar.wednesday_task">Vid√©os Instagram</td>
              <td data-i18n="calendar.wednesday_bonus">Liste de contact gratuite, Booster, Visibilit√©, Canva Pro</td>
            </tr>
            <tr class="thursday-task">
              <td data-i18n="calendar.thursday">JEUDI</td>
              <td data-i18n="calendar.thursday_task">Trivia Challenge</td>
              <td data-i18n="calendar.thursday_bonus">Liste de contact gratuite, Connexion gratuite, Roue de la fortune</td>
            </tr>
            <tr class="friday-task">
              <td data-i18n="calendar.friday">VENDREDI</td>
              <td data-i18n="calendar.friday_task">Gagner sur WhatsApp</td>
              <td data-i18n="calendar.friday_bonus">Booster, Visibilit√©, Canva Pro, Connexion gratuite</td>
            </tr>
            <tr class="saturday-task">
              <td data-i18n="calendar.saturday">SAMEDI</td>
              <td data-i18n="calendar.saturday_task">Gains Publicitaires</td>
              <td data-i18n="calendar.saturday_bonus">Liste de contact gratuite, Booster, Visibilit√©, Roue de la fortune</td>
            </tr>
            <tr class="sunday-task" style="opacity: 0.7;"> 
              <td data-i18n="calendar.sunday">DIMANCHE</td>
              <td data-i18n="calendar.sunday_task">Aucune t√¢che (Repos)</td>
              <td data-i18n="calendar.sunday_bonus">Connexion gratuite, Roue de la fortune</td>
            </tr>
          </tbody>
        </table>
      </div>
    </main>
  </div>

  <footer class="footer">
    <div class="footer-content">
      <div class="footer-links">
        <a href="terms.html" class="footer-link" data-i18n="footer.terms">Conditions d'utilisation</a>
        <a href="privacy.html" class="footer-link" data-i18n="footer.privacy">Politique de confidentialit√©</a>
        <button class="support-btn" id="supportBtn" data-i18n="footer.support">Support</button>
        <a href="https://social-boost-horizon-new-sbh.vercel.app" class="footer-link">Propuls√© par SBH</a>
        <a href="https://whatsapp.com/channel/0029VbBdIuN7YSd2pFCi2u05" class="footer-link">Boost Tech Management</a>
      </div>
      <div class="footer-text">
        ¬© 2025 BLOWEARN AGENCIES. <span data-i18n="footer.rights">Tous droits r√©serv√©s.</span>
      </div>
    </div>
  </footer>
  
<script>
/******** CONFIG FIREBASE ********/
const firebaseConfig = {
  apiKey: "AIzaSyCjGisjgbFc2ZE0BFgdhlUao8bCCeuKP1k",
  authDomain: "cash-flowr.firebaseapp.com",
  projectId: "cash-flowr",
  storageBucket: "cash-flowr.appspot.com",
  messagingSenderId: "1091928501310",
  appId: "1:1091928501310:web:4f4de306cde36f378ff56f",
  measurementId: "G-5SF6VDLZCB"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const auth = firebase.auth();

/******** URL SERVEUR ********/
const SERVER_URL = 'https://blowearn-agencies.replit.app';

/******** DOM Elements ********/
const hamburgerBtn = document.getElementById('hamburgerBtn');
const sidebar = document.getElementById('sidebar');
const overlay = document.getElementById('overlay');
const themeToggle = document.getElementById('themeToggle');
const userProfile = document.getElementById('userProfile');
const profileDropdown = document.getElementById('profileDropdown');
const copyLinkBtn = document.getElementById('copyLinkBtn');
const referralLink = document.getElementById('referralLink');
const languageSelector = document.getElementById('languageSelector');
const languageDropdown = document.getElementById('languageDropdown');
const currentLanguage = document.getElementById('currentLanguage');
const shareWhatsApp = document.getElementById('shareWhatsApp');
const shareFacebook = document.getElementById('shareFacebook');
const shareTwitter = document.getElementById('shareTwitter');
const shareTelegram = document.getElementById('shareTelegram');
const prevMonth = document.getElementById('prevMonth');
const nextMonth = document.getElementById('nextMonth');
const calendarGrid = document.querySelector('.calendar-grid');
const calendarMonth = document.querySelector('.calendar-month');
const sidebarUsername = document.getElementById('sidebarUsername');
const userAvatar = document.getElementById('userAvatar');
const infoUsername = document.getElementById('info-username');
const infoEmail = document.getElementById('info-email');
const infoPhone = document.getElementById('info-phone');
const infoCountry = document.getElementById('info-country');
const infoParrain = document.getElementById('info-parrain');
const infoParrainage = document.getElementById('info-parrainage');
const loader = document.getElementById('loader');
const welcomeBanner = document.getElementById('welcomeBanner');
const welcomeTitle = document.getElementById('welcomeTitle');
const welcomeMessage = document.getElementById('welcomeMessage');
const bannerUsername = document.getElementById('bannerUsername');
const supportBtn = document.getElementById('supportBtn');

/******** Variables d'√©tat ********/
let currentDate = new Date();
let userData = {};
let currentUser = null;
let currentLang = 'fr'; // Langue par d√©faut

/******** Syst√®me de traduction ********/
const translations = {
  fr: {
    "header.language": "French",
    "header.night_mode": "Mode nuit",
    "header.day_mode": "Mode jour",
    "dashboard.title": "Dashboard >> BLOWEARN AGENCIES",
    "menu.main": "PRINCIPAL",
    "menu.dashboard": "Tableau de bord",
    "menu.deposit": "D√©p√¥t üíµ",
    "menu.welcome_bonus": "Bonus de bienvenue",
    "menu.accounts": "COMPTES",
    "menu.withdrawal": "Retrait",
    "menu.team": "√âquipe",
    "menu.special": "SP√âCIAL",
    "menu.sbh": "SBH",
    "menu.challenge": "Challenge and Reward",
    "menu.products": "PRODUIT / T√ÇCHE",
    "menu.whatsapp_earn": "Gagner via Whatsapp",
    "menu.ad_earnings": "Gains publicitaires",
    "menu.fortune_wheel": "Roue de la fortune üèÜ",
    "menu.tiktok_earn": "TikTok Earn",
    "menu.youtube_earn": "YouTube Earn",
    "menu.instagram_earn": "Instagram Earn",
    "menu.trivia": "TRIVIA challenge",
    "menu.bonus": "BONUS",
    "menu.contact_list": "Liste de contacts gratuit üÜì",
    "menu.visibility_booster": "Booster ma visibilit√©",
    "menu.canva_pro": "Canva Pro",
    "menu.free_connection": "Connexion gratuite",
    "banner.welcome": "Bienvenue,",
    "banner.message": "BLOWEARN AGENCIES vous offre plus de 10 outils num√©riques pour maximiser vos revenus en ligne. Des annonces aux promotions YouTube et trivia, sp√©cialement con√ßus pour VOUS ! Am√©liorez votre pr√©sence en ligne d√®s maintenant ! üí∞ üöÄ",
    "banner.app_button": "CLIQUEZ ICI pour obtenir l'application Android",
    "banner.expense": "D√©pense:",
    "banner.profit": "Profit:",
    "stats.balance": "SOLDE",
    "stats.withdrawn": "Retir√©",
    "stats.referral_earnings": "Gains de parrainage",
    "stats.agent_bonus": "Bonus d'agent",
    "stats.volume": "Vol:(0%)",
    "gains.whatsapp": "Gains WhatsApp",
    "gains.trivia": "Gains Trivia",
    "gains.advertising": "Gains publicitaires",
    "gains.tiktok": "Gains TikTok",
    "gains.youtube": "Gains YouTube",
    "gains.instagram": "Gains Instagram",
    "gains.deposit_balance": "Solde du d√©p√¥t",
    "referral.title": "LIEN DE PARRAINAGE",
    "referral.copy": "Copier",
    "referral.description": "Partagez ce lien avec vos amis et gagnez des commissions sur leurs activit√©s.",
    "user_info.title": "INFORMATIONS UTILISATEUR",
    "user_info.username": "Nom d'utilisateur",
    "user_info.email": "Email",
    "user_info.phone": "T√©l√©phone",
    "user_info.country": "Pays",
    "user_info.referrer": "Parrain",
    "user_info.active_referrals": "Parrainage actif",
    "calendar.title": "CALENDRIER DES T√ÇCHES",
    "calendar.day": "JOUR",
    "calendar.task": "T√ÇCHE",
    "calendar.bonus": "BONUS",
    "calendar.mon": "Lun",
    "calendar.tue": "Mar",
    "calendar.wed": "Mer",
    "calendar.thu": "Jeu",
    "calendar.fri": "Ven",
    "calendar.sat": "Sam",
    "calendar.sun": "Dim",
    "calendar.monday": "LUNDI",
    "calendar.tuesday": "MARDI",
    "calendar.wednesday": "MERCREDI",
    "calendar.thursday": "JEUDI",
    "calendar.friday": "VENDREDI",
    "calendar.saturday": "SAMEDI",
    "calendar.sunday": "DIMANCHE",
    "calendar.monday_task": "Vid√©os TikTok",
    "calendar.tuesday_task": "Vid√©os YouTube",
    "calendar.wednesday_task": "Vid√©os Instagram",
    "calendar.thursday_task": "Trivia Challenge",
    "calendar.friday_task": "Gagner sur WhatsApp",
    "calendar.saturday_task": "Gains Publicitaires",
    "calendar.sunday_task": "Aucune t√¢che (Repos)",
    "calendar.monday_bonus": "Liste de contact gratuite, Booster, Visibilit√©, Roue de la fortune",
    "calendar.tuesday_bonus": "Liste de contact gratuite, Canva Pro, Connexion gratuite, Roue de la fortune",
    "calendar.wednesday_bonus": "Liste de contact gratuite, Booster, Visibilit√©, Canva Pro",
    "calendar.thursday_bonus": "Liste de contact gratuite, Connexion gratuite, Roue de la fortune",
    "calendar.friday_bonus": "Booster, Visibilit√©, Canva Pro, Connexion gratuite",
    "calendar.saturday_bonus": "Liste de contact gratuite, Booster, Visibilit√©, Roue de la fortune",
    "calendar.sunday_bonus": "Connexion gratuite, Roue de la fortune",
    "footer.terms": "Conditions d'utilisation",
    "footer.privacy": "Politique de confidentialit√©",
    "footer.support": "Support",
    "footer.rights": "Tous droits r√©serv√©s.",
    "notification.success": "Succ√®s",
    "notification.error": "Erreur",
    "notification.info": "Information",
    "security.inactive_account": "Compte inactif",
    "security.payment_required": "Votre compte n'est pas encore activ√©. Veuillez effectuer le paiement pour acc√©der au tableau de bord."
  },
  en: {
    "header.language": "English",
    "header.night_mode": "Night mode",
    "header.day_mode": "Day mode",
    "dashboard.title": "Dashboard >> BLOWEARN AGENCIES",
    "menu.main": "MAIN",
    "menu.dashboard": "Dashboard",
    "menu.deposit": "Deposit üíµ",
    "menu.welcome_bonus": "Welcome Bonus",
    "menu.accounts": "ACCOUNTS",
    "menu.withdrawal": "Withdrawal",
    "menu.team": "Team",
    "menu.special": "SPECIAL",
    "menu.sbh": "SBH",
    "menu.challenge": "Challenge and Reward",
    "menu.products": "PRODUCT / TASK",
    "menu.whatsapp_earn": "Earn via Whatsapp",
    "menu.ad_earnings": "Advertising earnings",
    "menu.fortune_wheel": "Fortune Wheel üèÜ",
    "menu.tiktok_earn": "TikTok Earn",
    "menu.youtube_earn": "YouTube Earn",
    "menu.instagram_earn": "Instagram Earn",
    "menu.trivia": "TRIVIA challenge",
    "menu.bonus": "BONUS",
    "menu.contact_list": "Free contact list üÜì",
    "menu.visibility_booster": "Boost my visibility",
    "menu.canva_pro": "Canva Pro",
    "menu.free_connection": "Free connection",
    "banner.welcome": "Welcome,",
    "banner.message": "BLOWEARN AGENCIES offers you more than 10 digital tools to maximize your online income. From ads to YouTube promotions and trivia, specially designed for YOU! Improve your online presence now! üí∞ üöÄ",
    "banner.app_button": "CLICK HERE to get the Android app",
    "banner.expense": "Expense:",
    "banner.profit": "Profit:",
    "stats.balance": "BALANCE",
    "stats.withdrawn": "Withdrawn",
    "stats.referral_earnings": "Referral earnings",
    "stats.agent_bonus": "Agent bonus",
    "stats.volume": "Vol:(0%)",
    "gains.whatsapp": "WhatsApp Earnings",
    "gains.trivia": "Trivia Earnings",
    "gains.advertising": "Advertising Earnings",
    "gains.tiktok": "TikTok Earnings",
    "gains.youtube": "YouTube Earnings",
    "gains.instagram": "Instagram Earnings",
    "gains.deposit_balance": "Deposit Balance",
    "referral.title": "REFERRAL LINK",
    "referral.copy": "Copy",
    "referral.description": "Share this link with your friends and earn commissions on their activities.",
    "user_info.title": "USER INFORMATION",
    "user_info.username": "Username",
    "user_info.email": "Email",
    "user_info.phone": "Phone",
    "user_info.country": "Country",
    "user_info.referrer": "Referrer",
    "user_info.active_referrals": "Active referrals",
    "calendar.title": "TASK CALENDAR",
    "calendar.day": "DAY",
    "calendar.task": "TASK",
    "calendar.bonus": "BONUS",
    "calendar.mon": "Mon",
    "calendar.tue": "Tue",
    "calendar.wed": "Wed",
    "calendar.thu": "Thu",
    "calendar.fri": "Fri",
    "calendar.sat": "Sat",
    "calendar.sun": "Sun",
    "calendar.monday": "MONDAY",
    "calendar.tuesday": "TUESDAY",
    "calendar.wednesday": "WEDNESDAY",
    "calendar.thursday": "THURSDAY",
    "calendar.friday": "FRIDAY",
    "calendar.saturday": "SATURDAY",
    "calendar.sunday": "SUNDAY",
    "calendar.monday_task": "TikTok Videos",
    "calendar.tuesday_task": "YouTube Videos",
    "calendar.wednesday_task": "Instagram Videos",
    "calendar.thursday_task": "Trivia Challenge",
    "calendar.friday_task": "Earn via WhatsApp",
    "calendar.saturday_task": "Advertising Earnings",
    "calendar.sunday_task": "No task (Rest)",
    "calendar.monday_bonus": "Free contact list, Booster, Visibility, Fortune Wheel",
    "calendar.tuesday_bonus": "Free contact list, Canva Pro, Free connection, Fortune Wheel",
    "calendar.wednesday_bonus": "Free contact list, Booster, Visibility, Canva Pro",
    "calendar.thursday_bonus": "Free contact list, Free connection, Fortune Wheel",
    "calendar.friday_bonus": "Booster, Visibility, Canva Pro, Free connection",
    "calendar.saturday_bonus": "Free contact list, Booster, Visibility, Fortune Wheel",
    "calendar.sunday_bonus": "Free connection, Fortune Wheel",
    "footer.terms": "Terms of Use",
    "footer.privacy": "Privacy Policy",
    "footer.support": "Support",
    "footer.rights": "All rights reserved.",
    "notification.success": "Success",
    "notification.error": "Error",
    "notification.info": "Information",
    "security.inactive_account": "Inactive account",
    "security.payment_required": "Your account is not yet activated. Please make the payment to access the dashboard."
  }
};

/******** Fonctions de traduction ********/
function setLanguage(lang) {
  currentLang = lang;
  localStorage.setItem('preferredLanguage', lang);
  currentLanguage.textContent = lang === 'fr' ? 'French' : 'English';
  
  document.querySelectorAll('.language-option').forEach(option => {
    const icon = option.querySelector('i');
    if (option.dataset.lang === lang) {
      option.classList.add('active');
      icon.style.opacity = '1';
    } else {
      option.classList.remove('active');
      icon.style.opacity = '0';
    }
  });
  
  document.querySelectorAll('[data-i18n]').forEach(element => {
    const key = element.getAttribute('data-i18n');
    if (translations[lang] && translations[lang][key]) {
      if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
        element.placeholder = translations[lang][key];
      } else {
        element.textContent = translations[lang][key];
      }
    }
  });
  
  const isDarkMode = document.body.classList.contains('dark-mode');
  if (themeToggle) {
    themeToggle.innerHTML = isDarkMode 
      ? `<i class="fas fa-sun"></i><span>${translations[lang]['header.day_mode']}</span>` 
      : `<i class="fas fa-moon"></i><span>${translations[lang]['header.night_mode']}</span>`;
  }
}

/******** UI helpers ********/
function showNotification(type, title, message, duration = 4000) {
  const container = document.getElementById('notificationContainer');
  if (!container) return;
  const notification = document.createElement('div');
  notification.className = `notification ${type}`;
  const icon = type === 'success' ? 'fa-check-circle' : (type === 'error' ? 'fa-exclamation-circle' : 'fa-info-circle');
  notification.innerHTML = `
    <i class="fas ${icon}" style="font-size: 1.5rem;"></i>
    <div>
      <strong style="display: block; margin-bottom: 5px;">${title}</strong>
      <span>${message}</span>
    </div>
  `;
  container.appendChild(notification);
  setTimeout(() => {
    notification.style.animation = 'slideIn 0.3s ease reverse forwards';
    setTimeout(() => { if (container.contains(notification)) container.removeChild(notification); }, 300);
  }, duration);
}

/******** UI events ********/
if (hamburgerBtn) {
  hamburgerBtn.addEventListener('click', () => {
      sidebar.classList.toggle('open');
      overlay.classList.toggle('active');
      hamburgerBtn.classList.toggle('open');
  });
}
if (overlay) {
  overlay.addEventListener('click', () => {
      sidebar.classList.remove('open');
      overlay.classList.remove('active');
      hamburgerBtn.classList.remove('open');
  });
}
if (userProfile) {
  userProfile.addEventListener('click', (event) => {
      event.stopPropagation();
      profileDropdown.classList.toggle('active');
  });
}
document.addEventListener('click', (event) => {
  if (!userProfile || !userProfile.contains(event.target)) {
    if (profileDropdown) profileDropdown.classList.remove('active');
  }
});

if (languageSelector) {
  languageSelector.addEventListener('click', (event) => {
    event.stopPropagation();
    languageDropdown.classList.toggle('active');
  });
}

document.addEventListener('click', () => {
  if (languageDropdown) languageDropdown.classList.remove('active');
});

document.querySelectorAll('.language-option').forEach(option => {
  option.addEventListener('click', () => {
    const lang = option.dataset.lang;
    setLanguage(lang);
    languageDropdown.classList.remove('active');
  });
});

if (themeToggle) {
  themeToggle.addEventListener('click', (event) => {
      event.stopPropagation();
      document.body.classList.toggle('dark-mode');
      const isDarkMode = document.body.classList.contains('dark-mode');
      themeToggle.innerHTML = isDarkMode 
          ? `<i class="fas fa-sun"></i><span>${translations[currentLang]['header.day_mode']}</span>` 
          : `<i class="fas fa-moon"></i><span>${translations[currentLang]['header.night_mode']}</span>`;
      if(currentUser) saveUserData('theme', isDarkMode ? 'dark' : 'light');
  });
}

/******** Bouton Support ********/
if (supportBtn) {
  supportBtn.addEventListener('click', () => {
    window.open('https://wa.me/681144638', '_blank');
  });
}

/******** Copy / share actions ********/
if (copyLinkBtn) {
  copyLinkBtn.addEventListener('click', () => {
    navigator.clipboard.writeText(referralLink.textContent)
      .then(() => showNotification('success', translations[currentLang]['notification.success'], 'Lien copi√© dans le presse-papier!'))
      .catch(() => showNotification('error', translations[currentLang]['notification.error'], 'Impossible de copier le lien.'));
  });
}

const promoMessage = {
  fr: "Tu veux gagner de l'argent en ligne? Regarde les vid√©os et gagne de l'argent. Sur ce lien, avec 3000 francs CFA seulement, tu peux gagner 5000 francs par jour. Si tu es int√©ress√©, je t'explique: ",
  en: "Do you want to earn money online? Watch videos and earn money. With this link, with only 3000 CFA francs, you can earn 5000 francs per day. If you're interested, I'll explain: "
};

if (shareWhatsApp) shareWhatsApp.addEventListener('click', () => { 
  window.open(`https://wa.me/?text=${encodeURIComponent(promoMessage[currentLang] + ' ' + referralLink.textContent)}`, '_blank'); 
});
if (shareFacebook) shareFacebook.addEventListener('click', () => { 
  window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(referralLink.textContent)}&quote=${encodeURIComponent(promoMessage[currentLang])}`, '_blank'); 
});
if (shareTwitter) shareTwitter.addEventListener('click', () => { 
  window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(promoMessage[currentLang])}&url=${encodeURIComponent(referralLink.textContent)}`, '_blank'); 
});
if (shareTelegram) shareTelegram.addEventListener('click', () => { 
  window.open(`https://t.me/share/url?url=${encodeURIComponent(referralLink.textContent)}&text=${encodeURIComponent(promoMessage[currentLang])}`, '_blank'); 
});

/******** Animation de pluie pour les cartes du deuxi√®me groupe ********/
function createRainEffect(containerId, dropCount = 15) {
  const container = document.getElementById(containerId);
  if (!container) return;
  
  for (let i = 0; i < dropCount; i++) {
    const drop = document.createElement('div');
    drop.className = 'rain-drop';
    const left = Math.random() * 100;
    const animationDuration = 1 + Math.random() * 2;
    const animationDelay = Math.random() * 2;
    drop.style.left = `${left}%`;
    drop.style.animationDuration = `${animationDuration}s`;
    drop.style.animationDelay = `${animationDelay}s`;
    container.appendChild(drop);
  }
}

/******** Calendrier am√©lior√© avec identification des t√¢ches du jour ********/
function updateCalendar() {
  if (!calendarGrid || !calendarMonth) return;
  const year = currentDate.getFullYear();
  const month = currentDate.getMonth();
  const monthNames = {
    fr: ["Janvier","F√©vrier","Mars","Avril","Mai","Juin","Juillet","Ao√ªt","Septembre","Octobre","Novembre","D√©cembre"],
    en: ["January","February","March","April","May","June","July","August","September","October","November","December"]
  };
  calendarMonth.textContent = `${monthNames[currentLang][month]} ${year}`;
  calendarGrid.innerHTML = '';
  const firstDay = new Date(year, month, 1).getDay();
  const daysInMonth = new Date(year, month + 1, 0).getDate();
  let startDay = firstDay === 0 ? 6 : firstDay - 1;
  for (let i=0; i < startDay; i++) { calendarGrid.insertAdjacentHTML('beforeend', '<div class="calendar-date"></div>'); }
  
  const today = new Date();
  const currentDayOfWeek = today.getDay();
  const dayNames = ['sunday', 'monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday'];
  const currentDayName = dayNames[currentDayOfWeek];
  
  for (let day=1; day <= daysInMonth; day++) {
    const dateCell = document.createElement('div');
    dateCell.className = 'calendar-date';
    dateCell.textContent = day;
    const date = new Date(year, month, day);
    const dayOfWeek = date.getDay();
    dateCell.classList.add(dayNames[dayOfWeek]);
    if (day === today.getDate() && month === today.getMonth() && year === today.getFullYear()) {
      dateCell.classList.add('active');
      dateCell.classList.add('today-task');
    }
    if (Math.random() > 0.7) dateCell.classList.add('has-task');
    calendarGrid.appendChild(dateCell);
  }
  
  const taskRows = document.querySelectorAll('.task-table tr');
  taskRows.forEach(row => {
    row.classList.remove('today-task');
    if (row.classList.contains(currentDayName + '-task')) {
      row.classList.add('today-task');
    }
  });
}
if (prevMonth) prevMonth.addEventListener('click', ()=>{ currentDate.setMonth(currentDate.getMonth()-1); updateCalendar(); });
if (nextMonth) nextMonth.addEventListener('click', ()=>{ currentDate.setMonth(currentDate.getMonth()+1); updateCalendar(); });

/******** Fonctions utilitaires ********/
function isPaidFlag(value) {
  if (typeof value === 'boolean') return value;
  if (typeof value === 'string') {
    const v = value.toLowerCase().trim();
    return ['true','yes','paid','pay√©','complete','completed','1','preuves re√ßues'].includes(v);
  }
  if (typeof value === 'number') return value === 1;
  return false;
}

function isUserPaidFromDoc(docData) {
  if (!docData) return false;
  const candidates = [
    docData.paid, docData.isPaid, docData.paiement, docData.paymentStatus,
    docData.status, docData.statut, docData.payment, docData.paidStatus
  ];
  for (const candidate of candidates) {
    if (candidate !== undefined && candidate !== null) {
      if (isPaidFlag(candidate)) return true;
    }
  }
  return false;
}

/******** Sauvegarde des donn√©es utilisateur ********/
async function saveUserData(key = null, value = null) {
  if (!currentUser) return;
  try {
    const userRef = db.collection('users').doc(currentUser.uid);
    const dataToSave = key ? { [key]: value } : userData;
    await userRef.set({ ...dataToSave, lastUpdate: new Date() }, { merge: true });
    console.log('Donn√©es utilisateur enregistr√©es.');
  } catch (error) {
    console.error("Erreur lors de la sauvegarde :", error);
    showNotification('error', translations[currentLang]['notification.error'], 'Impossible de sauvegarder vos donn√©es.');
  }
}

/******** Chargement des donn√©es utilisateur depuis Firestore ********/
async function loadUserData() {
  if (!currentUser) throw new Error("Aucun utilisateur connect√©.");
  
  let userRef = db.collection('users').doc(currentUser.uid);
  let doc = await userRef.get();
  let foundViaEmail = false;

  if (!doc.exists && currentUser.email) {
    console.log('‚ö†Ô∏è Document non trouv√© par UID, recherche par email...');
    const emailQuery = await db.collection('users').where('email', '==', currentUser.email).limit(1).get();
    if (!emailQuery.empty) {
      doc = emailQuery.docs[0];
      userRef = doc.ref;
      foundViaEmail = true;
      console.log('‚úÖ Utilisateur trouv√© par email:', currentUser.email);
    }
  }

  const defaultReferralEarnings = { level1: 0, level2: 0, level3: 0 };
  let parrainageTotal = 0;
  let activeReferrals = 0;
  let displayName = currentUser.displayName || (currentUser.email ? currentUser.email.split('@')[0] : 'Utilisateur');

  if (doc.exists) {
    const data = doc.data() || {};
    const refEarnings = data.referralEarnings || defaultReferralEarnings;

    parrainageTotal = (refEarnings.level1 || 0) + (refEarnings.level2 || 0) + (refEarnings.level3 || 0);
    activeReferrals = Number(data.totalReferrals || 0);
    displayName = data.displayName || displayName;

    userData = {
      depense: Number(data.depense || data.debit || 0),
      profit: Number(data.profit || data.revenue || 0),
      solde: Number(data.solde || data.balance || 0),
      retire: Number(data.retire || data.withdrawn || 0),
      parrainage: parrainageTotal,
      bonusAgent: Number(data.bonusAgent || data.agentBonus || 0),
      whatsappGains: Number(data.whatsappGains || 0),
      triviaGains: Number(data.triviaGains || 0),
      publiciteGains: Number(data.gainsPublicitaires || data.publiciteGains || 0),
      tiktokGains: Number(data.tiktokGains || 0),
      youtubeGains: Number(data.youtubeGains || 0),
      instagramGains: Number(data.instagramGains || data.instaGains || 0), 
      depotSolde: Number(data.depotSolde || data.depositBalance || 0),
      phoneNumber: data.phoneNumber || data.phone || "",
      country: data.country || data.pays || "",
      referrer: data.level1Sponsor || data.sponsorUsername || "Aucun",
      activeReferrals: activeReferrals,
      displayName: displayName,
      email: data.email || currentUser.email,
      paid: isUserPaidFromDoc(data),
      theme: data.theme || 'light',
      refEarnings: refEarnings,
      username: data.username || data.userName || null,
      status: data.status || data.statut || 'pending'
    };
  } else {
    userData = {
      depense:0, profit:0, solde:0, retire:0,
      parrainage:0, bonusAgent:0, whatsappGains:0,
      triviaGains:0, publiciteGains:0, tiktokGains:0,
      youtubeGains:0, instagramGains:0,
      depotSolde:0, paid:false, theme:'light',
      referrer:"Aucun", activeReferrals:0, refEarnings:defaultReferralEarnings,
      displayName:displayName, email:currentUser.email, username:null,
      status: 'pending'
    };
    await saveUserData();
  }
}

/******** Mise √† jour UI ********/
function formatNumberSafe(n) { return (typeof n === 'number' && !isNaN(n)) ? n.toLocaleString('fr-FR') : '0'; }

function updateDashboardUI() {
  try {
    const depenseBanner = document.querySelector('#banner-depense .banner-stat-value');
    const profitBanner = document.querySelector('#banner-profit .banner-stat-value');
    if(depenseBanner) depenseBanner.textContent = `XAF ${formatNumberSafe(userData.depense)}`;
    if(profitBanner) profitBanner.textContent = `XAF ${formatNumberSafe(userData.profit)}`;

    const solde = document.querySelector('#solde-card .large-stat-value');
    const retire = document.querySelector('#retire-card .medium-stat-value');
    if(solde) solde.textContent = `XAF ${formatNumberSafe(userData.solde)}`;
    if(retire) retire.textContent = `XAF ${formatNumberSafe(userData.retire)}`;

    const parrainageCard = document.querySelector('#parrainage-card .medium-stat-value');
    if(parrainageCard) parrainageCard.textContent = `XAF ${formatNumberSafe(userData.parrainage)}`;

    const bonusCard = document.querySelector('#bonus-agent-card .medium-stat-value');
    if(bonusCard) bonusCard.textContent = `XAF ${formatNumberSafe(userData.bonusAgent)}`;

    if(document.querySelector('#whatsapp-gains .gain-stat-value')) document.querySelector('#whatsapp-gains .gain-stat-value').textContent = `XAF ${formatNumberSafe(userData.whatsappGains)}`;
    if(document.querySelector('#trivia-gains .gain-stat-value')) document.querySelector('#trivia-gains .gain-stat-value').textContent = `XAF ${formatNumberSafe(userData.triviaGains)}`;
    if(document.querySelector('#publicite-gains .gain-stat-value')) document.querySelector('#publicite-gains .gain-stat-value').textContent = `XAF ${formatNumberSafe(userData.publiciteGains)}`;
    if(document.querySelector('#tiktok-gains .gain-stat-value')) document.querySelector('#tiktok-gains .gain-stat-value').textContent = `XAF ${formatNumberSafe(userData.tiktokGains)}`;
    if(document.querySelector('#youtube-gains .gain-stat-value')) document.querySelector('#youtube-gains .gain-stat-value').textContent = `XAF ${formatNumberSafe(userData.youtubeGains)}`;
    if(document.querySelector('#instagram-gains .gain-stat-value')) document.querySelector('#instagram-gains .gain-stat-value').textContent = `XAF ${formatNumberSafe(userData.instagramGains)}`; 
    if(document.querySelector('#depot-solde .gain-stat-value')) document.querySelector('#depot-solde .gain-stat-value').textContent = `XAF ${formatNumberSafe(userData.depotSolde)}`;
  } catch (err) {
    console.error('Erreur updateDashboardUI', err);
  }
}

function updateUserInfoUI(user, dbData = {}) {
  const displayName = dbData.displayName || user.displayName || (user.email ? user.email.split('@')[0] : 'Utilisateur');
  const email = dbData.email || user.email || 'Non sp√©cifi√©';
  const phone = dbData.phoneNumber || 'Non sp√©cifi√©';
  const country = dbData.country || 'Non sp√©cifi√©';
  const referrer = dbData.referrer || 'Aucun';
  const activeReferrals = dbData.activeReferrals || 0;

  if (sidebarUsername) sidebarUsername.textContent = displayName;
  if (userAvatar) userAvatar.textContent = displayName.charAt(0).toUpperCase();
  if (infoUsername) infoUsername.textContent = displayName;
  if (infoEmail) infoEmail.textContent = email;
  if (infoPhone) infoPhone.textContent = phone;
  if (infoCountry) infoCountry.textContent = country;
  if (infoParrain) infoParrain.textContent = referrer;
  if (infoParrainage) infoParrainage.textContent = `${activeReferrals} personnes`;

  if (bannerUsername) bannerUsername.textContent = displayName;
  if (welcomeMessage) welcomeMessage.innerHTML = `Nous sommes ravis de vous revoir sur <strong>BLOWEARN AGENCIES</strong>. Profitez de nos 10+ outils num√©riques pour booster vos revenus en ligne ! üí∞ üöÄ`;
}

/******** Communication serveur pour cr√©er lien avec username ********/
async function requestReferralLinkFromServer(username) {
  try {
    const resp = await fetch(`${SERVER_URL}/api/create-referral-link`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ username: username })
    });
    if (!resp.ok) return null;
    const json = await resp.json();
    if (json && json.referralLink) return json;
    return null;
  } catch (err) {
    console.error('requestReferralLinkFromServer error', err);
    return null;
  }
}

/******** R√©cup√©rer les statistiques de parrainage depuis le serveur ********/
async function fetchReferralStats(username) {
  try {
    const resp = await fetch(`${SERVER_URL}/api/referral-stats/${username}`);
    if (!resp.ok) return null;
    const json = await resp.json();
    return json.stats || null;
  } catch (err) {
    console.error('fetchReferralStats error', err);
    return null;
  }
}

/******** R√©cup√©rer la liste des filleuls depuis le serveur ********/
async function fetchMyReferrals(username) {
  try {
    const resp = await fetch(`${SERVER_URL}/api/my-referrals/${username}`);
    if (!resp.ok) return null;
    const json = await resp.json();
    return json.referrals || null;
  } catch (err) {
    console.error('fetchMyReferrals error', err);
    return null;
  }
}

/******** Start watcher: d√©tecte passage status -> 'paid' et appelle le serveur ********/
async function startStatusWatcherAndTriggerProcessing() {
  if (!currentUser) return;
  try {
    const userDocRef = db.collection('users').doc(currentUser.uid);

    userDocRef.onSnapshot(async (snap) => {
      if (!snap.exists) return;
      const d = snap.data();
      const status = (d.status || d.statut || '').toString().toLowerCase();
      const alreadyProcessed = !!d.referralProcessed;

      if (status === 'active' && !alreadyProcessed) {
        showNotification('info', translations[currentLang]['notification.info'], 'Paiement d√©tect√© ‚Äî distribution en cours...');
        try {
          const idToken = await currentUser.getIdToken();
          const resp = await fetch(`${SERVER_URL}/api/process-referral-on-paid`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${idToken}` },
            body: JSON.stringify({ userDocId: currentUser.uid })
          });
          const json = await resp.json().catch(()=>({}));
          if (resp.ok && json && json.ok) {
            showNotification('success', translations[currentLang]['notification.success'], 'Gains partag√©s aux parrains.');
            await loadUserData();
            updateDashboardUI();
            updateUserInfoUI(currentUser, userData);
          } else {
            console.error('Erreur process-referral-on-paid:', json);
            showNotification('error', translations[currentLang]['notification.error'], (json && json.error) ? json.error : 'Erreur lors du partage des gains.');
          }
        } catch (err) {
          console.error('Erreur appel process-referral-on-paid:', err);
          showNotification('error', translations[currentLang]['notification.error'], 'Impossible d\'appeler le serveur de parrainage.');
        }
      }
    });
  } catch (err) {
    console.error('startStatusWatcherAndTriggerProcessing erreur:', err);
  }
}

/******** ================================================= ********/
/******** S√âCURIT√â: V√©rification du statut "active" ********/
/******** ================================================= ********/
function checkUserStatusAndRedirect(userStatus) {
  // Normaliser le statut
  const status = (userStatus || '').toString().toLowerCase().trim();
  
  // SEUL le statut "active" permet d'acc√©der au dashboard
  if (status !== 'active') {
    console.log('üö´ S√âCURIT√â: Utilisateur NON ACTIF d√©tect√©. Status:', status);
    
    // Afficher une notification d'erreur
    showNotification('error', 
      translations[currentLang]['security.inactive_account'] || 'Compte inactif', 
      translations[currentLang]['security.payment_required'] || 'Votre compte n\'est pas encore activ√©. Veuillez effectuer le paiement pour acc√©der au tableau de bord.',
      5000
    );
    
    // D√©connecter l'utilisateur et rediriger vers la page de connexion
    setTimeout(() => {
      auth.signOut().then(() => {
        window.location.href = 'login.html';
      }).catch((err) => {
        console.error('Erreur d√©connexion:', err);
        // Forcer la redirection m√™me en cas d'erreur
        window.location.href = 'login.html';
      });
    }, 2000); // Attendre 2 secondes pour que l'utilisateur voie la notification
    
    return false; // Utilisateur non autoris√©
  }
  
  console.log('‚úÖ S√âCURIT√â: Utilisateur ACTIF. Acc√®s autoris√© au dashboard.');
  return true; // Utilisateur autoris√©
}

/******** Auth state change (point d'entr√©e) AVEC S√âCURIT√â ********/
auth.onAuthStateChanged(async (user) => {
  if (user) {
    currentUser = user;
    try {
      await loadUserData();

      // ============================================================
      // S√âCURIT√â CRITIQUE: V√©rifier si l'utilisateur est ACTIF
      // Si le statut n'est PAS "active", rediriger vers login.html
      // ============================================================
      const userStatus = userData.status || userData.statut || '';
      const isAuthorized = checkUserStatusAndRedirect(userStatus);
      
      if (!isAuthorized) {
        // L'utilisateur n'est pas autoris√©, arr√™ter le chargement du dashboard
        return;
      }
      // ============================================================

      // Charger les pr√©f√©rences sauvegard√©es
      const savedLang = localStorage.getItem('preferredLanguage') || 'fr';
      setLanguage(savedLang);

      // Mettre √† jour l'interface
      updateDashboardUI();
      updateUserInfoUI(currentUser, userData);

      // Appliquer le th√®me
      if (userData.theme === 'dark') {
        document.body.classList.add('dark-mode');
        if (themeToggle) {
          themeToggle.innerHTML = `<i class="fas fa-sun"></i><span>${translations[currentLang]['header.day_mode']}</span>`;
        }
      }

      // G√©n√©rer le lien de parrainage
      if (userData.username && referralLink) {
        const linkData = await requestReferralLinkFromServer(userData.username);
        if (linkData && linkData.referralLink) {
          referralLink.textContent = linkData.referralLink;
        } else {
          referralLink.textContent = `https://blowearn-agencies.vercel.app/index.html?ref=${userData.username}`;
        }
      } else if (referralLink) {
        referralLink.textContent = 'Lien non disponible';
      }

      // Cr√©er les effets de pluie
      createRainEffect('rain-solde', 20);
      createRainEffect('rain-retire', 15);
      createRainEffect('rain-parrainage', 15);
      createRainEffect('rain-bonus', 15);

      // Mettre √† jour le calendrier
      updateCalendar();

      // D√©marrer le watcher de statut
      startStatusWatcherAndTriggerProcessing();

      // Cacher le loader
      if (loader) loader.classList.add('hidden');

    } catch (err) {
      console.error('Erreur chargement dashboard:', err);
      showNotification('error', translations[currentLang]['notification.error'], 'Erreur lors du chargement de vos donn√©es.');
      if (loader) loader.classList.add('hidden');
    }
  } else {
    // Pas d'utilisateur connect√© -> rediriger vers login
    console.log('üö´ Aucun utilisateur connect√©. Redirection vers login.html');
    window.location.href = 'login.html';
  }
});
</script>
</body>
</html>
