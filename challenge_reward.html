<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>BLOWEARN AGENCIES - Challenge et Avantages</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800&family=Poppins:wght@500;600;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  
  <style>
    /* -------------------------------------------------------------------------- */
    /* --- VARIABLES CSS COH√âRENTES AVEC LA PAGE D'INSCRIPTION --- */
    /* -------------------------------------------------------------------------- */
    :root {
      --color-primary: #4A90E2; /* Bleu √ânergique */
      --color-secondary: #FFC107; /* Jaune Vif/Or pour l'accent */
      --color-text-dark: #2C3E50; /* Texte Sombre (lisible) */
      --color-text-light: #ECF0F1; /* Texte Clair */
      --color-bg-light: #FFFFFF; /* Fond de Carte */
      --color-bg-gradient-1: #6DD5FA; /* D√©grad√© Fond 1 */
      --color-bg-gradient-2: #FF7582; /* D√©grad√© Fond 2 */
      --success-color: #4CD964;
      --warning-color: #FF9500;
      --danger-color: #FF3B30;
      --shadow: 0 15px 40px rgba(0,0,0,0.1), 0 0 0 1px rgba(255,255,255,0.8);
      --transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }

    /* -------------------------------------------------------------------------- */
    /* --- STYLES G√âN√âRAUX COH√âRENTS --- */
    /* -------------------------------------------------------------------------- */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Montserrat', sans-serif;
      transition: var(--transition);
    }

    body {
      background: linear-gradient(135deg, var(--color-bg-gradient-1) 0%, var(--color-bg-gradient-2) 100%);
      color: var(--color-text-dark);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      position: relative;
      overflow-x: hidden;
    }

    /* Effet de bulles anim√©es en arri√®re-plan */
    body::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-image: 
        radial-gradient(circle at 10% 20%, rgba(255, 255, 255, 0.4) 0%, transparent 25%),
        radial-gradient(circle at 80% 10%, rgba(255, 255, 255, 0.3) 0%, transparent 25%),
        radial-gradient(circle at 40% 80%, rgba(255, 255, 255, 0.3) 0%, transparent 25%),
        radial-gradient(circle at 90% 90%, rgba(255, 255, 255, 0.2) 0%, transparent 25%);
      animation: float 20s ease-in-out infinite;
      z-index: -1;
    }
    
    @keyframes float {
      0%, 100% { transform: translateY(0) scale(1); }
      50% { transform: translateY(-15px) scale(1.02); }
    }

    /* -------------------------------------------------------------------------- */
    /* --- LOADER --- */
    /* -------------------------------------------------------------------------- */
    .loader-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, var(--color-bg-gradient-1) 0%, var(--color-bg-gradient-2) 100%);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 9999;
      transition: opacity 0.5s ease, visibility 0.5s ease;
    }

    .loader-container.hidden {
      opacity: 0;
      visibility: hidden;
    }

    .loader {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: conic-gradient(#0000 10%, var(--color-primary));
      -webkit-mask: radial-gradient(farthest-side, #0000 calc(100% - 8px), #000 0);
      animation: spin 1s infinite linear;
    }

    @keyframes spin {
      to { transform: rotate(1turn); }
    }

    /* -------------------------------------------------------------------------- */
    /* --- HEADER --- */
    /* -------------------------------------------------------------------------- */
    .header {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(15px);
      box-shadow: var(--shadow);
      padding: 15px 30px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: sticky;
      top: 0;
      z-index: 100;
      border-bottom: 1px solid rgba(255,255,255,0.7);
    }

    .logo {
      font-size: 1.8rem;
      font-weight: 800; /* Plus √©pais pour plus de visibilit√© */
      color: var(--color-text-dark); /* Chang√© pour plus de contraste */
      display: flex;
      align-items: center;
      font-family: 'Poppins', sans-serif;
      text-transform: uppercase;
      letter-spacing: 2px;
      text-shadow: 0 2px 4px rgba(0,0,0,0.1); /* Ombre plus prononc√©e */
      background: linear-gradient(45deg, var(--color-primary) 0%, var(--color-secondary) 100%); /* D√©grad√© plus contrast√© */
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      animation: logoGlow 3s ease-in-out infinite alternate;
    }
    
    @keyframes logoGlow {
      from { filter: drop-shadow(0 0 5px rgba(74, 144, 226, 0.5)); }
      to { filter: drop-shadow(0 0 15px rgba(255, 193, 7, 0.7)); }
    }

    .header-controls {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .language-selector {
      background: linear-gradient(135deg, var(--color-primary) 0%, #79C3F8 100%);
      color: white;
      border: none;
      border-radius: 20px;
      padding: 8px 15px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      font-weight: 500;
      box-shadow: 0 4px 15px rgba(74, 144, 226, 0.3);
      position: relative;
    }

    .language-dropdown {
      position: absolute;
      top: 100%;
      right: 0;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(15px);
      box-shadow: var(--shadow);
      border-radius: 12px;
      padding: 8px;
      display: none;
      flex-direction: column;
      gap: 5px;
      min-width: 140px;
      z-index: 200;
      transform-origin: top right;
      animation: scaleIn 0.2s ease-out forwards;
      border: 1px solid rgba(255,255,255,0.7);
      margin-top: 5px;
    }

    .language-dropdown.active {
      display: flex;
    }

    .language-option {
      padding: 8px 12px;
      border-radius: 8px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: background-color 0.2s ease;
    }

    .language-option:hover {
      background-color: rgba(0, 0, 0, 0.05);
    }

    .language-option.active {
      background-color: rgba(74, 144, 226, 0.1);
      color: var(--color-primary);
      font-weight: 600;
    }

    .theme-toggle {
      background-color: transparent;
      border: none;
      color: var(--color-text-dark);
      cursor: pointer;
      padding: 5px;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background-color 0.3s ease;
    }

    .theme-toggle:hover {
      background-color: rgba(0, 0, 0, 0.05);
    }

    .theme-toggle i {
      font-size: 1.2rem;
    }

    .user-profile {
      display: flex;
      align-items: center;
      gap: 10px;
      cursor: pointer;
      position: relative;
    }
    
    .user-profile .avatar {
      width: 45px;
      height: 45px;
      border-radius: 50%;
      background-color: var(--color-primary);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 1.2rem;
      font-weight: bold;
      border: 2px solid var(--color-secondary);
      box-shadow: var(--shadow);
    }

    .profile-dropdown {
      position: absolute;
      top: 100%;
      right: 0;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(15px);
      box-shadow: var(--shadow);
      border-radius: 18px;
      padding: 10px;
      display: none;
      flex-direction: column;
      gap: 5px;
      min-width: 150px;
      z-index: 200;
      transform-origin: top right;
      animation: scaleIn 0.2s ease-out forwards;
      border: 1px solid rgba(255,255,255,0.7);
    }

    .profile-dropdown.active {
      display: flex;
    }
    
    @keyframes scaleIn {
      from { transform: scale(0.9); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }

    .profile-dropdown .theme-toggle {
      width: 100%;
      border-radius: 8px;
      background-color: rgba(0, 0, 0, 0.05);
      color: var(--text-color);
      justify-content: flex-start;
      padding: 10px;
      transition: background-color 0.2s ease, transform 0.2s ease;
      text-align: left;
      gap: 10px;
    }

    .profile-dropdown .theme-toggle:hover {
      background-color: rgba(0, 0, 0, 0.1);
      transform: translateY(-2px);
    }
    
    .profile-dropdown .theme-toggle span {
      flex-grow: 1;
      text-align: left;
    }

    /* -------------------------------------------------------------------------- */
    /* --- BOUTON HAMBURGER (D√âPLAC√â √Ä DROITE) --- */
    /* -------------------------------------------------------------------------- */
    .hamburger-btn {
      display: none;
      background: none;
      border: none;
      cursor: pointer;
      display: flex;
      flex-direction: column;
      justify-content: space-around;
      width: 30px;
      height: 25px;
      padding: 0;
      order: 2; /* Pour le placer √† droite dans le header */
    }
    
    .hamburger-btn .bar {
      width: 100%;
      height: 3px;
      background-color: var(--color-text-dark);
      transition: transform 0.3s ease, opacity 0.3s ease;
    }
    
    .hamburger-btn.open .bar:nth-child(2) {
      opacity: 0;
    }
    
    .hamburger-btn.open .bar:nth-child(1) {
      transform: translateY(11px) rotate(45deg);
    }
    
    .hamburger-btn.open .bar:nth-child(3) {
      transform: translateY(-11px) rotate(-45deg);
    }

    /* -------------------------------------------------------------------------- */
    /* --- STRUCTURE PRINCIPALE --- */
    /* -------------------------------------------------------------------------- */
    .main-container {
      display: flex;
      flex: 1;
    }

    /* -------------------------------------------------------------------------- */
    /* --- SIDEBAR (MENU) AM√âLIOR√â AVEC NOUVEAU FOND ET POLICE --- */
    /* -------------------------------------------------------------------------- */
    .sidebar {
      width: 280px;
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.98) 0%, rgba(240, 245, 255, 0.95) 100%);
      backdrop-filter: blur(15px);
      border-right: 1px solid rgba(255,255,255,0.7);
      box-shadow: var(--shadow);
      height: calc(100vh - 80px);
      position: sticky;
      top: 80px;
      padding: 25px 0;
      overflow-y: auto;
      transition: transform 0.4s ease-in-out; 
    }
    
    .sidebar.open {
      transform: translateX(0);
    }

    .welcome-section {
      padding: 0 25px 25px;
      border-bottom: 1px solid rgba(0, 0, 0, 0.1);
      margin-bottom: 20px;
    }

    .welcome-text {
      color: var(--color-text-dark);
      font-size: 0.9rem;
      margin-bottom: 5px;
      font-weight: 500;
      font-family: 'Quicksand', sans-serif;
    }

    .username {
      font-weight: 600;
      font-size: 1.2rem;
      color: var(--color-primary);
      font-family: 'Quicksand', sans-serif;
    }

    .menu-category {
      padding: 15px 25px 5px;
      font-size: 0.85rem;
      color: var(--color-text-dark);
      text-transform: uppercase;
      letter-spacing: 1px;
      font-weight: 600;
      font-family: 'Quicksand', sans-serif;
      border-bottom: 1px solid rgba(0, 0, 0, 0.05);
    }

    .menu-item {
      padding: 12px 25px 12px 35px;
      display: flex;
      align-items: center;
      gap: 15px;
      color: var(--color-text-dark);
      text-decoration: none;
      font-weight: 500;
      border-left: 4px solid transparent;
      position: relative;
      overflow: hidden;
      animation: fadeIn 0.5s ease-out;
      font-family: 'Quicksand', sans-serif;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateX(-20px); }
      to { opacity: 1; transform: translateX(0); }
    }
    
    .menu-item::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(0, 0, 0, 0.05), transparent);
      transition: all 0.5s ease;
    }
    
    .menu-item:hover::before {
      left: 100%;
    }

    .menu-item:hover, .menu-item.active {
      background-color: rgba(0, 0, 0, 0.05);
      border-left-color: var(--color-primary);
      color: var(--color-primary);
    }

    .menu-item i {
      width: 20px;
      text-align: center;
      font-size: 1.1rem;
      transition: transform 0.3s ease;
    }

    .menu-item:hover i {
      transform: scale(1.1) rotate(5deg);
    }

    .menu-badge {
      position: absolute;
      right: 25px;
      font-size: 0.75rem;
      font-weight: 700;
      padding: 2px 8px;
      border-radius: 10px;
      text-shadow: 0 1px 1px rgba(0, 0, 0, 0.2);
      animation: popIn 0.5s ease-out;
    }
    
    @keyframes popIn {
      from { transform: scale(0); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }
    
    .menu-badge.active {
      background-color: var(--success-color);
      color: white;
    }
    
    .menu-badge.inactive {
      background-color: var(--danger-color);
      color: white;
    }

    /* -------------------------------------------------------------------------- */
    /* --- CONTENU PRINCIPAL --- */
    /* -------------------------------------------------------------------------- */
    .content {
      flex: 1;
      padding: 30px;
    }

    .page-title {
      font-size: 1.5rem;
      margin-bottom: 25px;
      color: var(--color-text-dark);
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 10px;
      font-family: 'Poppins', sans-serif;
    }

    .page-title i {
      color: var(--color-primary);
    }

    /* -------------------------------------------------------------------------- */
    /* --- BANNI√àRE CHALLENGE --- */
    /* -------------------------------------------------------------------------- */
    .challenge-banner {
      background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-secondary) 100%);
      border-radius: 18px;
      padding: 25px;
      box-shadow: var(--shadow);
      margin-bottom: 30px;
      color: white;
      position: relative;
      overflow: hidden;
      animation: fadeInUp 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }

    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(40px) scale(0.95); }
      to { opacity: 1; transform: translateY(0) scale(1); }
    }

    .challenge-banner::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: linear-gradient(to right, transparent, rgba(255, 255, 255, 0.2), transparent);
      transform: rotate(45deg);
      animation: shimmer 3s infinite;
    }

    @keyframes shimmer {
      0% { transform: translateX(-100%) rotate(45deg); }
      100% { transform: translateX(100%) rotate(45deg); }
    }

    .banner-title {
      font-size: 1.5rem;
      margin-bottom: 15px;
      font-weight: 600;
      position: relative;
      z-index: 1;
    }

    .banner-text {
      font-size: 1rem;
      margin-bottom: 20px;
      opacity: 0.9;
      position: relative;
      z-index: 1;
      line-height: 1.6;
    }

    /* -------------------------------------------------------------------------- */
    /* --- SECTIONS CHALLENGE --- */
    /* -------------------------------------------------------------------------- */
    .challenge-section {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(15px);
      border-radius: 18px;
      padding: 25px;
      box-shadow: var(--shadow);
      margin-bottom: 30px;
      position: relative;
      overflow: hidden;
      border: 1px solid rgba(255,255,255,0.7);
      animation: fadeInUp 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }

    .challenge-section::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 5px;
      background: linear-gradient(90deg, var(--color-primary), var(--color-secondary));
      border-radius: 18px 18px 0 0;
    }

    .section-title {
      font-size: 1.3rem;
      margin-bottom: 20px;
      color: var(--color-text-dark);
      font-weight: 600;
      position: relative;
      z-index: 1;
      font-family: 'Poppins', sans-serif;
    }

    .section-title i {
      color: var(--color-primary);
    }

    .section-subtitle {
      font-size: 1rem;
      margin-bottom: 20px;
      color: var(--color-text-dark);
      opacity: 0.8;
    }

    /* -------------------------------------------------------------------------- */
    /* --- TABLEAU DES MEILLEURS PARRAINS --- */
    /* -------------------------------------------------------------------------- */
    .leaderboard-table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
      margin-top: 20px;
      overflow: hidden;
      border-radius: 8px;
    }

    .leaderboard-table th, .leaderboard-table td {
      padding: 15px;
      text-align: left;
      border-bottom: 1px solid rgba(0, 0, 0, 0.1);
    }

    .leaderboard-table th {
      background-color: rgba(0, 0, 0, 0.05);
      font-weight: 600;
      color: var(--color-text-dark);
      text-transform: uppercase;
      font-size: 0.9rem;
    }

    .leaderboard-table tr:last-child td {
        border-bottom: none;
    }
    
    .leaderboard-table tr {
      transition: background-color 0.2s ease;
    }

    .leaderboard-table tr:hover {
      background-color: rgba(0, 0, 0, 0.03);
    }

    .rank-cell {
      font-weight: 700;
      text-align: center;
      width: 60px;
    }

    .rank-1 {
      color: #FFD700;
      font-size: 1.3rem;
    }

    .rank-2 {
      color: #C0C0C0;
      font-size: 1.2rem;
    }

    .rank-3 {
      color: #CD7F32;
      font-size: 1.1rem;
    }

    .advantage-cell {
      font-weight: 600;
      color: var(--color-primary);
    }

    /* -------------------------------------------------------------------------- */
    /* --- SECTION RANG UTILISATEUR --- */
    /* -------------------------------------------------------------------------- */
    .user-rank {
      margin-top: 25px;
      padding: 20px;
      background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-secondary) 100%);
      border-radius: 12px;
      color: white;
      text-align: center;
      box-shadow: var(--shadow);
    }

    .user-rank h3 {
      margin-bottom: 10px;
      font-size: 1.2rem;
    }

    .user-rank-value {
      font-size: 2rem;
      font-weight: 700;
      margin-bottom: 10px;
      text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.3); 
    }

    .user-referrals {
      font-size: 1.1rem;
      margin-bottom: 15px;
    }
    
    /* -------------------------------------------------------------------------- */
    /* --- SECTION DES AVANTAGES --- */
    /* -------------------------------------------------------------------------- */
    .advantages-list {
        list-style: none;
        padding-left: 0;
        margin-top: 20px;
    }
    
    .advantages-list li {
        background-color: rgba(0, 0, 0, 0.05);
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 10px;
        display: flex;
        align-items: center;
        gap: 15px;
        font-weight: 500;
        transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    
    .advantages-list li:hover {
        transform: translateY(-3px);
        box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
    }
    
    .advantages-list li strong {
        color: var(--color-primary);
        font-weight: 700;
        min-width: 100px;
    }
    
    .advantages-list li i {
        color: var(--color-primary);
        font-size: 1.2rem;
    }
    
    .how-to-participate p {
        margin-bottom: 15px;
        line-height: 1.6;
        color: var(--color-text-dark);
        opacity: 0.8;
    }

    /* -------------------------------------------------------------------------- */
    /* --- FOOTER AM√âLIOR√â --- */
    /* -------------------------------------------------------------------------- */
    .footer {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(15px);
      padding: 20px 30px;
      text-align: center;
      box-shadow: 0 -4px 12px rgba(0, 0, 0, 0.08);
      margin-top: auto;
      border-top: 1px solid rgba(255,255,255,0.7);
    }

    .footer-content {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .footer-links {
      display: flex;
      justify-content: center;
      gap: 20px;
      flex-wrap: wrap;
    }

    .footer-link {
      color: var(--color-primary);
      text-decoration: none;
      font-weight: 500;
      transition: color 0.2s ease;
    }

    .footer-link:hover {
      text-decoration: underline;
      color: var(--color-secondary);
    }

    .footer-text {
      color: var(--color-text-dark);
      font-size: 0.9rem;
    }

    /* Bouton de support */
    .support-btn {
      background: linear-gradient(135deg, var(--color-primary) 0%, #79C3F8 100%);
      color: white;
      border: none;
      border-radius: 10px;
      padding: 10px 20px;
      cursor: pointer;
      font-weight: 600;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
      box-shadow: 0 4px 15px rgba(74, 144, 226, 0.3);
      margin-top: 10px;
    }

    .support-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(74, 144, 226, 0.4);
    }

    /* -------------------------------------------------------------------------- */
    /* --- NOTIFICATIONS --- */
    /* -------------------------------------------------------------------------- */
    .notification-container {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 9999;
      display: flex;
      flex-direction: column;
      gap: 10px;
      pointer-events: none;
    }

    .notification {
      padding: 15px 20px;
      border-radius: 10px;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
      display: flex;
      align-items: center;
      gap: 10px;
      max-width: 350px;
      animation: slideIn 0.3s ease forwards;
      position: relative;
      overflow: hidden;
      color: white;
      pointer-events: auto;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.2);
    }

    .notification.success {
      background: linear-gradient(135deg, var(--success-color) 0%, #2AB32A 100%);
    }

    .notification.error {
      background: linear-gradient(135deg, var(--danger-color) 0%, #c0392b 100%);
    }

    .notification.info { 
      background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-secondary) 100%); 
    }

    @keyframes slideIn {
      from {
        transform: translateX(110%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    /* -------------------------------------------------------------------------- */
    /* --- OVERLAY --- */
    /* -------------------------------------------------------------------------- */
    .overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 98;
    }
    
    .overlay.active {
      display: block;
    }

    /* -------------------------------------------------------------------------- */
    /* --- MODE NUIT --- */
    /* -------------------------------------------------------------------------- */
    .dark-mode {
      --color-primary: #5e81ac;
      --color-secondary: #d08770;
      --color-text-dark: #eceff4;
      --color-text-light: #2e3440;
      --color-bg-light: #3b4252;
      --color-bg-gradient-1: #2e3440;
      --color-bg-gradient-2: #4c566a;
      --success-color: #a3be8c;
      --warning-color: #ebcb8b;
      --danger-color: #bf616a;
      --shadow: 0 15px 40px rgba(0,0,0,0.3), 0 0 0 1px rgba(255,255,255,0.1);
    }

    .dark-mode body::before {
      background-image: 
        radial-gradient(circle at 10% 20%, rgba(76, 86, 106, 0.4) 0%, transparent 25%),
        radial-gradient(circle at 80% 10%, rgba(76, 86, 106, 0.3) 0%, transparent 25%),
        radial-gradient(circle at 40% 80%, rgba(76, 86, 106, 0.3) 0%, transparent 25%),
        radial-gradient(circle at 90% 90%, rgba(76, 86, 106, 0.2) 0%, transparent 25%);
    }

    .dark-mode .header,
    .dark-mode .sidebar,
    .dark-mode .challenge-section,
    .dark-mode .footer {
      background: rgba(59, 66, 82, 0.95);
      color: var(--color-text-dark);
    }

    .dark-mode .challenge-banner {
      background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-secondary) 100%);
    }

    .dark-mode .advantages-list li {
        background-color: rgba(255, 255, 255, 0.05);
    }

    .dark-mode .leaderboard-table th {
      background-color: rgba(255, 255, 255, 0.1);
    }

    .dark-mode .leaderboard-table tr:hover {
      background-color: rgba(255, 255, 255, 0.05);
    }

    /* -------------------------------------------------------------------------- */
    /* --- RESPONSIVE --- */
    /* -------------------------------------------------------------------------- */
    @media (max-width: 992px) {
      .sidebar {
        width: 230px;
      }
    }

    @media (max-width: 768px) {
      .main-container {
        flex-direction: column;
      }
      
      .hamburger-btn {
        display: flex;
        position: static; /* Position normale dans le flux */
        order: 2; /* Pour le placer √† droite */
      }

      .sidebar {
        width: 85%;
        max-width: 320px;
        height: 100vh;
        position: fixed;
        top: 0;
        left: -100%;
        z-index: 99;
        transition: left 0.4s ease-in-out;
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.98) 0%, rgba(240, 245, 255, 0.97) 100%);
      }
      
      .sidebar.open {
        left: 0;
      }
      
      .header {
        padding: 15px;
      }
      
      .logo {
        font-size: 1.5rem;
        margin-left: 0; /* Supprim√© le d√©calage pr√©c√©dent */
      }
      
      .content {
        padding: 20px;
      }
      
      .leaderboard-table {
        font-size: 0.9rem;
      }
      
      .leaderboard-table th, .leaderboard-table td {
        padding: 10px;
      }
      
      .advantages-list li {
          flex-direction: column;
          align-items: flex-start;
      }
      
      .advantages-list li strong {
          min-width: unset;
      }
    }

    @media (max-width: 576px) {
      .leaderboard-table {
        display: block;
        overflow-x: auto;
      }
      
      .footer-links {
        flex-direction: column;
        gap: 10px;
      }
    }
  </style>
</head>
<body>
  <div class="loader-container" id="loader">
    <div class="loader"></div>
  </div>

  <div class="notification-container" id="notificationContainer"></div>

  <header class="header">
    <div class="logo">
      <span>BLOWEARN</span>
    </div>
    
    <div class="header-controls">
      <div class="language-selector-container">
        <button class="language-selector" id="languageSelector">
          <i class="fas fa-globe"></i>
          <span id="currentLanguage">French</span>
          <i class="fas fa-chevron-down"></i>
        </button>
        <div class="language-dropdown" id="languageDropdown">
          <div class="language-option active" data-lang="fr">
            <i class="fas fa-check"></i>
            <span>Fran√ßais</span>
          </div>
          <div class="language-option" data-lang="en">
            <i class="fas fa-check" style="opacity: 0;"></i>
            <span>English</span>
          </div>
        </div>
      </div>
      
      <button class="hamburger-btn" id="hamburgerBtn" aria-label="Toggle menu">
        <div class="bar"></div>
        <div class="bar"></div>
        <div class="bar"></div>
      </button>
      
      <div class="user-profile" id="userProfile">
          <div class="avatar" id="userAvatar">U</div>
          <div class="profile-dropdown" id="profileDropdown">
              <button class="theme-toggle" id="themeToggle">
                  <i class="fas fa-moon"></i>
                  <span>Mode nuit</span>
              </button>
          </div>
      </div>
    </div>
  </header>

  <div class="overlay" id="overlay"></div>

  <div class="main-container">
    <aside class="sidebar" id="sidebar">
      <div class="welcome-section">
        <div class="welcome-text" data-i18n="dashboard.title">Challenge et Avantages >> BLOWEARN AGENCIES</div>
        <div class="username" id="sidebarUsername">Utilisateur</div>
      </div>
      
      <div class="menu-category" data-i18n="menu.main">PRINCIPAL</div>
      <a href="dashboard.html" class="menu-item">
        <i class="fas fa-home"></i>
        <span data-i18n="menu.dashboard">Tableau de bord</span>
      </a>
      
      <a href="depot.html" class="menu-item">
        <i class="fas fa-wallet"></i>
        <span data-i18n="menu.deposit">D√©p√¥t üíµ</span>
      </a>
      
      <a href="bonus_bienvenue.html" class="menu-item">
        <i class="fas fa-gift"></i>
        <span data-i18n="menu.welcome_bonus">Bonus de bienvenue</span>
      </a>
      
      <div class="menu-category" data-i18n="menu.accounts">COMPTES</div>
      <a href="retrait.html" class="menu-item">
        <i class="fas fa-money-bill-wave"></i>
        <span data-i18n="menu.withdrawal">Retrait</span>
      </a>
      
      <a href="equipe.html" class="menu-item">
        <i class="fas fa-users"></i>
        <span data-i18n="menu.team">√âquipe</span>
      </a>

      <div class="menu-category" data-i18n="menu.special">SP√âCIAL</div>
      
      <a href="social_boost.html" class="menu-item">
        <i class="fas fa-rocket"></i>
        <span data-i18n="menu.sbh">SBH</span>
      </a>
      
      <a href="challenge_reward.html" class="menu-item active">
        <i class="fas fa-medal"></i>
        <span data-i18n="menu.challenge">Challenge and Reward</span>
        <span class="menu-badge active">‚òë</span>
      </a>
      
      <div class="menu-category" data-i18n="menu.products">PRODUIT / T√ÇCHE</div>
      <a href="whatsapp_earn.html" class="menu-item">
        <i class="fab fa-whatsapp"></i>
        <span data-i18n="menu.whatsapp_earn">Gagner via Whatsapp</span>
      </a>
      
      <a href="gains_publicitaires.html" class="menu-item">
        <i class="fas fa-ad"></i>
        <span data-i18n="menu.ad_earnings">Gains publicitaires</span>
      </a>
      
      <a href="spin_wheel.html" class="menu-item">
        <i class="fas fa-trophy"></i>
        <span data-i18n="menu.fortune_wheel">Roue de la fortune üèÜ</span>
      </a>
      
      <a href="tiktok_earn.html" class="menu-item">
        <i class="fab fa-tiktok"></i>
        <span data-i18n="menu.tiktok_earn">TikTok Earn</span>
      </a>
      
      <a href="youtube_earn.html" class="menu-item">
        <i class="fab fa-youtube"></i>
        <span data-i18n="menu.youtube_earn">YouTube Earn</span>
      </a>
      
      <a href="instagram_earn.html" class="menu-item">
        <i class="fab fa-instagram"></i>
        <span data-i18n="menu.instagram_earn">Instagram Earn</span>
      </a>
      
      <a href="trivia_challenge.html" class="menu-item">
        <i class="fas fa-brain"></i>
        <span data-i18n="menu.trivia">TRIVIA challenge</span>
      </a>
      
      <div class="menu-category" data-i18n="menu.bonus">BONUS</div>
      <a href="liste_contacts.html" class="menu-item">
        <i class="fas fa-address-book"></i>
        <span data-i18n="menu.contact_list">Liste de contacts gratuit üÜì</span>
      </a>
      
      <a href="booster_visibilite.html" class="menu-item">
        <i class="fas fa-rocket"></i>
        <span data-i18n="menu.visibility_booster">Booster ma visibilit√©</span>
      </a>

      <a href="canva_pro.html" class="menu-item">
        <i class="fas fa-palette"></i>
        <span data-i18n="menu.canva_pro">Canva Pro</span>
      </a>
      
      <a href="connexion_gratuite.html" class="menu-item">
        <i class="fas fa-shield-alt"></i>
        <span data-i18n="menu.free_connection">Connexion gratuite</span>
      </a>
    </aside>

    <main class="content">
      <h1 class="page-title">
        <i class="fas fa-medal"></i>
        <span data-i18n="challenge.title">Challenge et Avantages</span>
      </h1>
      
      <div class="challenge-banner">
        <h2 class="banner-title" data-i18n="challenge.banner_title">D√©fiez-vous et obtenez des avantages!</h2>
        <div class="banner-text" data-i18n="challenge.banner_text">
          Le classement des meilleurs parrains de BLOWEARN AGENCIES! Ici, nous mettons en lumi√®re les membres les plus actifs qui ont parrain√© le plus de personnes. Plus vous parrainez, plus vous grimpez dans le classement et plus vos avantages sont importants. Les avantages sont mis √† jour chaque semaine, alors continuez √† inviter vos amis!
        </div>
      </div>
      
      <div class="challenge-section">
        <h2 class="section-title"><i class="fas fa-trophy"></i> <span data-i18n="challenge.leaderboard_title">Classement des Parrains d'√âlite</span></h2>
        <p class="section-subtitle" data-i18n="challenge.leaderboard_subtitle">Voici le top 20 des parrains ayant parrain√© **au moins 20 personnes**. Les 5 premiers b√©n√©ficient d'avantages sp√©ciaux!</p>
        
        <table class="leaderboard-table">
          <thead>
            <tr>
              <th class="rank-cell" data-i18n="challenge.rank">Rang</th>
              <th data-i18n="challenge.username">Nom d'utilisateur</th>
              <th data-i18n="challenge.referrals">Personnes parrain√©es</th>
              <th data-i18n="challenge.advantage">Avantage</th>
            </tr>
          </thead>
          <tbody id="leaderboardBody">
            <!-- Le classement sera g√©n√©r√© par JavaScript -->
          </tbody>
        </table>
        
        <div class="user-rank" id="userRankSection">
          <h3 data-i18n="challenge.your_ranking">Votre classement</h3>
          <div class="user-rank-value" id="userRank">--</div>
          <div class="user-referrals" id="userReferrals">Personnes parrain√©es: 0</div>
          <p data-i18n="challenge.encouragement">Continuez √† parrainer pour grimper dans le classement et d√©bloquer des avantages!</p>
        </div>
      </div>
      
      <div class="challenge-section">
        <h2 class="section-title"><i class="fas fa-gift"></i> <span data-i18n="challenge.advantages_title">Syst√®me d'Avantages</span></h2>
        <p class="section-subtitle" data-i18n="challenge.advantages_subtitle">D√©couvrez les avantages exclusifs que vous pouvez gagner en parrainant vos proches.</p>
        
        <div class="how-to-participate">
          <h4 data-i18n="challenge.weekly_advantages">Avantages hebdomadaires (pour le Top 5):</h4>
          <ul class="advantages-list">
            <li><i class="fas fa-star"></i><strong data-i18n="challenge.first_place">1√®re place:</strong> <span data-i18n="challenge.first_prize">Multipliez votre solde par 4 + 20 000 FCFA</span></li>
            <li><i class="fas fa-star"></i><strong data-i18n="challenge.second_place">2√®me place:</strong> <span data-i18n="challenge.second_prize">Multipliez votre solde par 3 + 15 000 FCFA</span></li>
            <li><i class="fas fa-star"></i><strong data-i18n="challenge.third_place">3√®me place:</strong> <span data-i18n="challenge.third_prize">Multipliez votre solde par 2 + 10 000 FCFA</span></li>
            <li><i class="fas fa-check-circle"></i><strong data-i18n="challenge.fourth_place">4√®me place:</strong> <span data-i18n="challenge.fourth_prize">5 000 FCFA</span></li>
            <li><i class="fas fa-check-circle"></i><strong data-i18n="challenge.fifth_place">5√®me place:</strong> <span data-i18n="challenge.fifth_prize">1 000 FCFA</span></li>
          </ul>
          
          <h4 data-i18n="challenge.how_to_participate_title">Comment participer:</h4>
          <p data-i18n="challenge.how_to_participate">Pour participer au challenge, vous devez avoir parrain√© **au moins 20 personnes**. Ensuite, il suffit de parrainer un maximum de personnes en partageant votre lien de parrainage. Chaque personne qui s'inscrit via votre lien augmente votre score dans le classement.</p>
          
          <h4 data-i18n="challenge.when_distributed_title">Quand sont distribu√©s les avantages:</h4>
          <p data-i18n="challenge.when_distributed">Les avantages sont distribu√©s chaque dimanche √† minuit. Le classement est remis √† z√©ro chaque semaine pour donner √† tous une chance de gagner.</p>
        </div>
      </div>
    </main>
  </div>

  <footer class="footer">
    <div class="footer-content">
      <div class="footer-links">
        <a href="terms.html" class="footer-link" data-i18n="footer.terms">Conditions d'utilisation</a>
        <a href="privacy.html" class="footer-link" data-i18n="footer.privacy">Politique de confidentialit√©</a>
        <button class="support-btn" id="supportBtn" data-i18n="footer.support">Support</button>
        <a href="https://social-boost-horizon-new-sbh.vercel.app" class="footer-link">Propuls√© par SBH</a>
        <a href="https://social-boost-horizon-new-sbh.vercel.app" class="footer-link">Boost Text Management</a>
      </div>
      <div class="footer-text">
        ¬© 2025 BLOWEARN AGENCIES. <span data-i18n="footer.rights">Tous droits r√©serv√©s.</span>
      </div>
    </div>
  </footer>
  
<script>
/******** CONFIG FIREBASE ********/
const firebaseConfig = {
  apiKey: "AIzaSyCjGisjgbFc2ZE0BFgdhlUao8bCCeuKP1k",
  authDomain: "cash-flowr.firebaseapp.com",
  projectId: "cash-flowr",
  storageBucket: "cash-flowr.appspot.com",
  messagingSenderId: "1091928501310",
  appId: "1:1091928501310:web:4f4de306cde36f378ff56f",
  measurementId: "G-5SF6VDLZCB"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const auth = firebase.auth();

/******** DOM Elements ********/
const hamburgerBtn = document.getElementById('hamburgerBtn');
const sidebar = document.getElementById('sidebar');
const overlay = document.getElementById('overlay');
const themeToggle = document.getElementById('themeToggle');
const userProfile = document.getElementById('userProfile');
const profileDropdown = document.getElementById('profileDropdown');
const languageSelector = document.getElementById('languageSelector');
const languageDropdown = document.getElementById('languageDropdown');
const currentLanguage = document.getElementById('currentLanguage');
const sidebarUsername = document.getElementById('sidebarUsername');
const userAvatar = document.getElementById('userAvatar');
const loader = document.getElementById('loader');
const leaderboardBody = document.getElementById('leaderboardBody');
const userRankSection = document.getElementById('userRankSection');
const userRank = document.getElementById('userRank');
const userReferrals = document.getElementById('userReferrals');
const supportBtn = document.getElementById('supportBtn');

/******** Variables d'√©tat ********/
let currentUser = null;
let userData = {};
let currentLang = 'fr'; // Langue par d√©faut

/******** Syst√®me de traduction ********/
const translations = {
  fr: {
    // Header
    "header.language": "French",
    "header.night_mode": "Mode nuit",
    "header.day_mode": "Mode jour",
    
    // Dashboard
    "dashboard.title": "Dashboard >> BLOWEARN AGENCIES",
    
    // Menu
    "menu.main": "PRINCIPAL",
    "menu.dashboard": "Tableau de bord",
    "menu.deposit": "D√©p√¥t üíµ",
    "menu.welcome_bonus": "Bonus de bienvenue",
    "menu.accounts": "COMPTES",
    "menu.withdrawal": "Retrait",
    "menu.team": "√âquipe",
    "menu.special": "SP√âCIAL",
    "menu.sbh": "SBH",
    "menu.challenge": "Challenge and Reward",
    "menu.products": "PRODUIT / T√ÇCHE",
    "menu.whatsapp_earn": "Gagner via Whatsapp",
    "menu.ad_earnings": "Gains publicitaires",
    "menu.fortune_wheel": "Roue de la fortune üèÜ",
    "menu.tiktok_earn": "TikTok Earn",
    "menu.youtube_earn": "YouTube Earn",
    "menu.instagram_earn": "Instagram Earn",
    "menu.trivia": "TRIVIA challenge",
    "menu.bonus": "BONUS",
    "menu.contact_list": "Liste de contacts gratuit üÜì",
    "menu.visibility_booster": "Booster ma visibilit√©",
    "menu.canva_pro": "Canva Pro",
    "menu.free_connection": "Connexion gratuite",
    
    // Challenge
    "challenge.title": "Challenge et Avantages",
    "challenge.banner_title": "D√©fiez-vous et obtenez des avantages!",
    "challenge.banner_text": "Le classement des meilleurs parrains de BLOWEARN AGENCIES! Ici, nous mettons en lumi√®re les membres les plus actifs qui ont parrain√© le plus de personnes. Plus vous parrainez, plus vous grimpez dans le classement et plus vos avantages sont importants. Les avantages sont mis √† jour chaque semaine, alors continuez √† inviter vos amis!",
    "challenge.leaderboard_title": "Classement des Parrains d'√âlite",
    "challenge.leaderboard_subtitle": "Voici le top 20 des parrains ayant parrain√© **au moins 20 personnes**. Les 5 premiers b√©n√©ficient d'avantages sp√©ciaux!",
    "challenge.rank": "Rang",
    "challenge.username": "Nom d'utilisateur",
    "challenge.referrals": "Personnes parrain√©es",
    "challenge.advantage": "Avantage",
    "challenge.your_ranking": "Votre classement",
    "challenge.encouragement": "Continuez √† parrainer pour grimper dans le classement et d√©bloquer des avantages!",
    "challenge.advantages_title": "Syst√®me d'Avantages",
    "challenge.advantages_subtitle": "D√©couvrez les avantages exclusifs que vous pouvez gagner en parrainant vos proches.",
    "challenge.weekly_advantages": "Avantages hebdomadaires (pour le Top 5):",
    "challenge.first_place": "1√®re place:",
    "challenge.first_prize": "Multipliez votre solde par 4 + 20 000 FCFA",
    "challenge.second_place": "2√®me place:",
    "challenge.second_prize": "Multipliez votre solde par 3 + 15 000 FCFA",
    "challenge.third_place": "3√®me place:",
    "challenge.third_prize": "Multipliez votre solde par 2 + 10 000 FCFA",
    "challenge.fourth_place": "4√®me place:",
    "challenge.fourth_prize": "5 000 FCFA",
    "challenge.fifth_place": "5√®me place:",
    "challenge.fifth_prize": "1 000 FCFA",
    "challenge.how_to_participate_title": "Comment participer:",
    "challenge.how_to_participate": "Pour participer au challenge, vous devez avoir parrain√© **au moins 20 personnes**. Ensuite, il suffit de parrainer un maximum de personnes en partageant votre lien de parrainage. Chaque personne qui s'inscrit via votre lien augmente votre score dans le classement.",
    "challenge.when_distributed_title": "Quand sont distribu√©s les avantages:",
    "challenge.when_distributed": "Les avantages sont distribu√©s chaque dimanche √† minuit. Le classement est remis √† z√©ro chaque semaine pour donner √† tous une chance de gagner.",
    
    // Footer
    "footer.terms": "Conditions d'utilisation",
    "footer.privacy": "Politique de confidentialit√©",
    "footer.support": "Support",
    "footer.rights": "Tous droits r√©serv√©s.",
    
    // Notifications
    "notification.success": "Succ√®s",
    "notification.error": "Erreur",
    "notification.info": "Information"
  },
  en: {
    // Header
    "header.language": "English",
    "header.night_mode": "Night mode",
    "header.day_mode": "Day mode",
    
    // Dashboard
    "dashboard.title": "Dashboard >> BLOWEARN AGENCIES",
    
    // Menu
    "menu.main": "MAIN",
    "menu.dashboard": "Dashboard",
    "menu.deposit": "Deposit üíµ",
    "menu.welcome_bonus": "Welcome Bonus",
    "menu.accounts": "ACCOUNTS",
    "menu.withdrawal": "Withdrawal",
    "menu.team": "Team",
    "menu.special": "SPECIAL",
    "menu.sbh": "SBH",
    "menu.challenge": "Challenge and Reward",
    "menu.products": "PRODUCT / TASK",
    "menu.whatsapp_earn": "Earn via Whatsapp",
    "menu.ad_earnings": "Advertising earnings",
    "menu.fortune_wheel": "Fortune Wheel üèÜ",
    "menu.tiktok_earn": "TikTok Earn",
    "menu.youtube_earn": "YouTube Earn",
    "menu.instagram_earn": "Instagram Earn",
    "menu.trivia": "TRIVIA challenge",
    "menu.bonus": "BONUS",
    "menu.contact_list": "Free contact list üÜì",
    "menu.visibility_booster": "Boost my visibility",
    "menu.canva_pro": "Canva Pro",
    "menu.free_connection": "Free connection",
    
    // Challenge
    "challenge.title": "Challenge and Rewards",
    "challenge.banner_title": "Challenge yourself and get advantages!",
    "challenge.banner_text": "The ranking of the best sponsors of BLOWEARN AGENCIES! Here we highlight the most active members who have referred the most people. The more you refer, the higher you climb in the ranking and the more important your advantages are. Advantages are updated every week, so keep inviting your friends!",
    "challenge.leaderboard_title": "Elite Sponsors Ranking",
    "challenge.leaderboard_subtitle": "Here are the top 20 sponsors who have referred **at least 20 people**. The top 5 benefit from special advantages!",
    "challenge.rank": "Rank",
    "challenge.username": "Username",
    "challenge.referrals": "People referred",
    "challenge.advantage": "Advantage",
    "challenge.your_ranking": "Your ranking",
    "challenge.encouragement": "Continue to refer to climb the ranking and unlock advantages!",
    "challenge.advantages_title": "Advantages System",
    "challenge.advantages_subtitle": "Discover the exclusive advantages you can earn by referring your friends.",
    "challenge.weekly_advantages": "Weekly advantages (for Top 5):",
    "challenge.first_place": "1st place:",
    "challenge.first_prize": "Multiply your balance by 4 + 20,000 FCFA",
    "challenge.second_place": "2nd place:",
    "challenge.second_prize": "Multiply your balance by 3 + 15,000 FCFA",
    "challenge.third_place": "3rd place:",
    "challenge.third_prize": "Multiply your balance by 2 + 10,000 FCFA",
    "challenge.fourth_place": "4th place:",
    "challenge.fourth_prize": "5,000 FCFA",
    "challenge.fifth_place": "5th place:",
    "challenge.fifth_prize": "1,000 FCFA",
    "challenge.how_to_participate_title": "How to participate:",
    "challenge.how_to_participate": "To participate in the challenge, you must have referred **at least 20 people**. Then, just refer as many people as possible by sharing your referral link. Each person who registers via your link increases your score in the ranking.",
    "challenge.when_distributed_title": "When are advantages distributed:",
    "challenge.when_distributed": "Advantages are distributed every Sunday at midnight. The ranking is reset every week to give everyone a chance to win.",
    
    // Footer
    "footer.terms": "Terms of Use",
    "footer.privacy": "Privacy Policy",
    "footer.support": "Support",
    "footer.rights": "All rights reserved.",
    
    // Notifications
    "notification.success": "Success",
    "notification.error": "Error",
    "notification.info": "Information"
  }
};

/******** Fonctions de traduction ********/
function setLanguage(lang) {
  currentLang = lang;
  localStorage.setItem('preferredLanguage', lang);
  
  // Mettre √† jour le s√©lecteur de langue
  currentLanguage.textContent = lang === 'fr' ? 'French' : 'English';
  
  // Mettre √† jour les options de langue
  document.querySelectorAll('.language-option').forEach(option => {
    const icon = option.querySelector('i');
    if (option.dataset.lang === lang) {
      option.classList.add('active');
      icon.style.opacity = '1';
    } else {
      option.classList.remove('active');
      icon.style.opacity = '0';
    }
  });
  
  // Traduire tous les √©l√©ments avec data-i18n
  document.querySelectorAll('[data-i18n]').forEach(element => {
    const key = element.getAttribute('data-i18n');
    if (translations[lang] && translations[lang][key]) {
      if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
        element.placeholder = translations[lang][key];
      } else {
        element.textContent = translations[lang][key];
      }
    }
  });
  
  // Mettre √† jour le texte du th√®me
  const isDarkMode = document.body.classList.contains('dark-mode');
  if (themeToggle) {
    themeToggle.innerHTML = isDarkMode 
      ? `<i class="fas fa-sun"></i><span>${translations[lang]['header.day_mode']}</span>` 
      : `<i class="fas fa-moon"></i><span>${translations[lang]['header.night_mode']}</span>`;
  }
}

/******** UI helpers ********/
function showNotification(type, title, message, duration = 4000) {
  const container = document.getElementById('notificationContainer');
  if (!container) return;
  const notification = document.createElement('div');
  notification.className = `notification ${type}`;
  const icon = type === 'success' ? 'fa-check-circle' : (type === 'error' ? 'fa-exclamation-circle' : 'fa-info-circle');
  notification.innerHTML = `
    <i class="fas ${icon}" style="font-size: 1.5rem;"></i>
    <div>
      <strong style="display: block; margin-bottom: 5px;">${title}</strong>
      <span>${message}</span>
    </div>
  `;
  container.appendChild(notification);
  setTimeout(() => {
    notification.style.animation = 'slideIn 0.3s ease reverse forwards';
    setTimeout(() => { if (container.contains(notification)) container.removeChild(notification); }, 300);
  }, duration);
}

/******** UI events ********/
if (hamburgerBtn) {
  hamburgerBtn.addEventListener('click', () => {
      sidebar.classList.toggle('open');
      overlay.classList.toggle('active');
      hamburgerBtn.classList.toggle('open');
  });
}
if (overlay) {
  overlay.addEventListener('click', () => {
      sidebar.classList.remove('open');
      overlay.classList.remove('active');
      hamburgerBtn.classList.remove('open');
  });
}
if (userProfile) {
  userProfile.addEventListener('click', (event) => {
      event.stopPropagation();
      profileDropdown.classList.toggle('active');
  });
}
document.addEventListener('click', (event) => {
  if (!userProfile || !userProfile.contains(event.target)) {
    if (profileDropdown) profileDropdown.classList.remove('active');
  }
});

// Gestion du s√©lecteur de langue
if (languageSelector) {
  languageSelector.addEventListener('click', (event) => {
    event.stopPropagation();
    languageDropdown.classList.toggle('active');
  });
}

// Fermer le dropdown de langue quand on clique ailleurs
document.addEventListener('click', () => {
  if (languageDropdown) languageDropdown.classList.remove('active');
});

// Changer de langue
document.querySelectorAll('.language-option').forEach(option => {
  option.addEventListener('click', () => {
    const lang = option.dataset.lang;
    setLanguage(lang);
    languageDropdown.classList.remove('active');
  });
});

if (themeToggle) {
  themeToggle.addEventListener('click', (event) => {
      event.stopPropagation();
      document.body.classList.toggle('dark-mode');
      const isDarkMode = document.body.classList.contains('dark-mode');
      themeToggle.innerHTML = isDarkMode 
          ? `<i class="fas fa-sun"></i><span>${translations[currentLang]['header.day_mode']}</span>` 
          : `<i class="fas fa-moon"></i><span>${translations[currentLang]['header.night_mode']}</span>`;
      if(currentUser) saveUserData('theme', isDarkMode ? 'dark' : 'light');
  });
}

/******** Bouton Support ********/
if (supportBtn) {
  supportBtn.addEventListener('click', () => {
    window.open('https://wa.me/681144638', '_blank');
  });
}

/******** Fonctions Firestore ********/
async function saveUserData(key = null, value = null) {
  if (!currentUser) return;
  try {
    const userRef = db.collection('users').doc(currentUser.uid);
    const dataToSave = key ? { [key]: value } : userData;
    await userRef.set({ ...dataToSave, lastUpdate: new Date() }, { merge: true });
    console.log('Donn√©es utilisateur enregistr√©es avec succ√®s.');
  } catch (error) {
    console.error("Erreur lors de la sauvegarde des donn√©es :", error);
    showNotification('error', translations[currentLang]['notification.error'], 'Impossible de sauvegarder vos donn√©es.');
  }
}

async function loadUserData() {
  if (!currentUser) throw new Error("Aucun utilisateur connect√© pour charger les donn√©es.");
  
  // Chercher par UID puis par email (comme dans dashboard)
  let userRef = db.collection('users').doc(currentUser.uid);
  let doc = await userRef.get();
  let foundViaEmail = false;

  // FALLBACK: Si pas trouv√© par UID, chercher par email
  if (!doc.exists && currentUser.email) {
    console.log('‚ö†Ô∏è Document non trouv√© par UID, recherche par email...');
    const emailQuery = await db.collection('users').where('email', '==', currentUser.email).limit(1).get();
    if (!emailQuery.empty) {
      doc = emailQuery.docs[0];
      userRef = doc.ref;
      foundViaEmail = true;
      console.log('‚úÖ Utilisateur trouv√© par email:', currentUser.email);
    }
  }

  const displayName = currentUser.displayName || (currentUser.email ? currentUser.email.split('@')[0] : 'Utilisateur');

  if (doc.exists) {
    const data = doc.data() || {};
    userData = {
      displayName: data.displayName || displayName,
      email: data.email || currentUser.email,
      phoneNumber: data.phoneNumber || data.phone || "",
      country: data.country || data.pays || "",
      theme: data.theme || 'light',
      totalReferrals: data.totalReferrals || 0 
    };
  } else {
    userData = { theme: 'light', totalReferrals: 0, displayName: displayName, email: currentUser.email };
    await saveUserData();
  }
}

async function getTopReferrers() {
  try {
    const usersRef = db.collection('users');
    // REQU√äTE MISE √Ä JOUR : utilise 'totalReferrals' et filtre >= 20
    const querySnapshot = await usersRef
      .where('totalReferrals', '>=', 20)
      .orderBy('totalReferrals', 'desc')
      .limit(20)
      .get();
    
    const topReferrers = [];
    querySnapshot.forEach((doc) => {
      const data = doc.data();
      topReferrers.push({
        id: doc.id,
        displayName: data.displayName || 'Utilisateur',
        // Utilise totalReferrals
        totalReferrals: data.totalReferrals || 0 
      });
    });
    
    return topReferrers;
  } catch (error) {
    console.error("Erreur lors de la r√©cup√©ration des meilleurs parrains :", error);
    showNotification('error', translations[currentLang]['notification.error'], 'Impossible de charger le classement.');
    return [];
  }
}

function displayLeaderboard(referrers) {
  if (referrers.length === 0) {
    leaderboardBody.innerHTML = `
      <tr>
        <td colspan="4" style="text-align: center; padding: 30px;">
          Aucun parrain n'a encore atteint 20 parrainages. Soyez le premier!
        </td>
      </tr>
    `;
    return;
  }
  
  let html = '';
  referrers.forEach((referrer, index) => {
    const rank = index + 1;
    // Remplacement de 'r√©compense' par 'avantage'
    let advantage = ''; 
    
    // D√©terminer l'avantage en fonction du rang
    if (rank === 1) advantage = 'x4 solde + 20K FCFA';
    else if (rank === 2) advantage = 'x3 solde + 15K FCFA';
    else if (rank === 3) advantage = 'x2 solde + 10K FCFA';
    else if (rank === 4) advantage = '5 000 FCFA';
    else if (rank === 5) advantage = '1 000 FCFA';
    else advantage = '---';
    
    html += `
      <tr>
        <td class="rank-cell ${rank <= 3 ? 'rank-' + rank : ''}">${rank}</td>
        <td>${referrer.displayName}</td>
        <td>${referrer.totalReferrals}</td>
        <td class="advantage-cell">${advantage}</td>
      </tr>
    `;
  });
  
  leaderboardBody.innerHTML = html;
}

function updateUserRank(referrers) {
  if (!currentUser) return;
  
  // Trouver le rang de l'utilisateur actuel
  const userIndex = referrers.findIndex(ref => ref.id === currentUser.uid);
  
  if (userIndex !== -1) {
    userRank.textContent = `#${userIndex + 1}`;
  } else {
    userRank.textContent = 'Hors top 20';
  }
  
  // Utilisation de totalReferrals
  userReferrals.textContent = `Personnes parrain√©es: ${userData.totalReferrals || 0}`; 
}

/******** Initialisation de l'application ********/
function updateUserInfoUI(user, dbData = {}) {
    const displayName = dbData.displayName || user.displayName || (user.email ? user.email.split('@')[0] : 'Utilisateur');
    if (sidebarUsername) sidebarUsername.textContent = displayName;
    if (userAvatar) userAvatar.textContent = displayName.charAt(0).toUpperCase();
}

function applyTheme() {
    const isDarkMode = userData.theme === 'dark';
    document.body.classList.toggle('dark-mode', isDarkMode);
    if (themeToggle) {
      themeToggle.innerHTML = isDarkMode 
          ? `<i class="fas fa-sun"></i><span>${translations[currentLang]['header.day_mode']}</span>` 
          : `<i class="fas fa-moon"></i><span>${translations[currentLang]['header.night_mode']}</span>`;
    }
}

auth.onAuthStateChanged(async (user) => {
    if (user) {
        currentUser = user;
        try {
            await loadUserData();
            updateUserInfoUI(user, userData);
            applyTheme();
            
            // Charger le classement
            const topReferrers = await getTopReferrers();
            displayLeaderboard(topReferrers);
            updateUserRank(topReferrers);
            
            document.body.classList.add('loaded');
            loader.classList.add('hidden');
            
        } catch (error) {
            console.error("Erreur critique lors de l'initialisation :", error);
            showNotification('error', translations[currentLang]['notification.error'], "Impossible de charger vos donn√©es. Veuillez vous reconnecter.");
            auth.signOut();
            setTimeout(() => { window.location.href = 'login.html'; }, 3000);
        }
    } else {
        // Redirection si l'utilisateur n'est pas connect√©
        if (window.location.pathname !== '/login.html') {
            window.location.href = 'login.html';
        } else {
             // Si on est d√©j√† sur la page de login, on masque juste le loader
            document.body.classList.add('loaded');
            loader.classList.add('hidden');
        }
    }
});

/******** Initialisation au chargement de la page ********/
document.addEventListener('DOMContentLoaded', () => {
  // Charger la langue sauvegard√©e ou utiliser le fran√ßais par d√©faut
  const savedLang = localStorage.getItem('preferredLanguage') || 'fr';
  setLanguage(savedLang);
});
</script>
</body>
</html>